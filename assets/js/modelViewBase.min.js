apex.model={},function(e,t,i,n,s,r,l){"use strict";const d="table",a="tree",o="record",h="Malformed response",c="refresh",u="addData",f="revert",g="refreshRecords",_="delete",p="clearChanges",y="set",I="destroy",m="one",v="none";let R={},x=[],w=100,b=10;const F=new Set(["genIdPrefix","pageItemsToSubmit","fetchData","saveData","regionData","requestOptions","parentRecordId","editable","pageSize","callServer","visibilityFilter","visibilityFilterContext","trackChanges","onlyMarkForDelete"]),M=n.hasOwnProperty,A=l.extend,S=Array.isArray,D=l.isPlainObject,C=e=>"function"==typeof e,K=l.Deferred,T=n.equalValue,k=r.toNumber;function E(e){return e.replace(/#/g,"").split(/\s*,\s*/)}function O(e){return"object"==typeof e&&M(e,"v")}function q(e){if("string"==typeof e)return[e,null];if(S(e)&&2===e.length&&"string"==typeof e[0]&&(null===e[1]||"string"==typeof e[1]))return e;throw new Error("Invalid model id")}const V=new Map;function P(e){let t=V.get(e);return t||(t=1e3),V.set(e,t+1),t}function N(e){if(S(e)){let t=[];for(let i=0;i<e.length;i++)t.push(N(e[i]));return t}return D(e)?A(!0,{},e):e}function j(e,t,i){let n=e._listeners;for(let e=0;e<n.length;e++)n[e].onChange(t,i)}function U(e,t,i,n,s,r){e?t.call(e,i,n,s,r):t(i,n,s)}function z(e){e.allowedOperations&&(e.canEdit=!!e.allowedOperations.update,e.canDelete=!!e.allowedOperations.delete)}function W(e){return"string"==typeof e?e:S(e)?1===e.length?""+e[0]:JSON.stringify(e):e.toString()}function $(e,t){var i,s=[],r=[];function d(e){var t,i,n=e._listeners;for(t=0;t<n.length;t++)(i=n[t].progressView)&&i[0]&&i[0].offsetWidth&&i[0].offsetHeight&&(s.push(i),r.push(n[t].progressOptions||null))}if(d(e),t)for(i=0;i<t.length;i++)d(t[i]);return 0===s.length?null:e._options.makeLoadingIndicator?e._options.makeLoadingIndicator(s,r):function(){var e,t,i=l();for(e=0;e<s.length;e++)t=n.showSpinner(s[e],r[e]),i=i.add(t);return function(){i.remove()}}}function B(e,t){return A({},e.requestOptions,{loadingIndicator:$(t)})}function H(e,t,i,n){let s,r=e;return n&&(r+=" Server status: "+n),s=new Error(r),t&&t.status>=0&&(s.status=t.status),s}function G(e,t){var i,n;for(i in delete e.error,delete e.warning,delete e.message,e.fields)M(e.fields,i)&&(n=e.fields[i],t||(delete n.changed,delete n.stale),delete n.error,delete n.warning,delete n.message)}function L(e,t,i){let n=-1,s=-1;return t-1>=0&&(n=parseFloat(e[t-1][i])),t<e.length&&(s=parseFloat(e[t][i])),[n,s]}function J(e,t,i,n,s,r){let l;return-1===t&&(t=0),r&&r>t&&(-1===i||r<i)?r:(-1===i&&(i=t+e*n),l=i-t,t+l/(n+1)*s)}const X=e=>new Error(`Model has invalid shape for the ${e} method`),Y=e=>new Error(`Wrong data type for ${e} aggregate`),Q=()=>new Error("Model must have identityField defined"),Z=(e,t)=>new Error(`Field '${e}' depends on unknown field/item '${t}'`),ee=(e,t)=>new Error(e+" field not found: "+t);function te(e,t,i){var n,s,r,l;for(n in t)M(t,n)&&((s=t[n]).volatile||s.virtual||"string"==typeof(l=e[r=i?s.index:n])&&(e[r]=l.replace(/\r\n/g,"\n")))}function ie(e,t,i,n,r){let l=e._options,d=t.record,a=e._getIdentity(d),o=[];!function t(i,n,s){for(let r=0;r<i.length;r++){let d,a=i[r],o=l.fields[a];o&&!n[a]&&(o.dependsOn&&t(o.dependsOn,n,s),n[a]||!o.calcValue&&!o.dependsOn||(s.push(a),n[a]=1,d=e._dependentFields[a],d&&t(d,n,s)))}}(i,r||{},o);for(let i=0;i<o.length;i++){let r,h,c,u,f,g,_,p,I=o[i],m=l.fields[I];if(m.calcValue){g=[];for(let t=0;t<m.dependsOn.length;t++)c=m.dependsOn[t],":"===c.substr(0,1)?_=s(c.substr(1)).getValue():(u=l.fields[c],_=e.getValue(d,c),"NUMBER"===m.dataType&&(_=k(_,u?u.formatMask:null))),g.push(_);if(p=m.calcValue(g,e,d),r=e.getFieldKey(I),t.fields&&t.fields[I]&&t.fields[I].ck)throw new Error("Set calculated value not allowed for field");h=d[r],T(h,p)||(d[r]=p,t.fields||(t.fields={}),f=t.fields[I],f||(f={},t.fields[I]=f),l.trackChanges&&(f.changed=!0),n&&j(e,y,{oldValue:h,oldIdentity:null,recordId:a,record:d,field:I}),e._checkAggregates(I))}else m.cellTemplate?(r=e.getFieldKey(I),h=d[r],n&&j(e,y,{oldValue:h,oldIdentity:null,recordId:a,record:d,field:I})):(f=t.fields[I],f||(f={},t.fields[I]=f),f.stale=!0,n&&e.metadataChanged(a,I,"stale"))}}function ne(e,t){let i={},n=t.record,s=[];for(let t=0;t<e._calculatedFields.length;t++){let r=e._calculatedFields[t];null==n[e.getFieldKey(r)]?s.push(r):i[r]=1}s.length>0&&ie(e,t,s,!1,i)}const se={SUM:{name:"SUM",init:function(e){if(e.dataType&&"NUMBER"!==e.dataType)throw Y("SUM");e.total=0,e.grandTotal=0},add:function(e,t){t=k(t,e.formatMask),isNaN(t)||(e.total+=t,e.grandTotal+=t)},get:function(e,t){const i=t?e.total:e.grandTotal;return t&&(e.total=0),i}},AVG:{name:"AVG",init:function(e){if(e.dataType&&"NUMBER"!==e.dataType)throw Y("AVG");e.total=0,e.grandTotal=0,e.count=0,e.totalCount=0},add:function(e,t){t=k(t,e.formatMask),isNaN(t)||(e.total+=t,e.grandTotal+=t,e.count+=1,e.totalCount+=1)},get:function(e,t){const i=t?e.total/e.count:e.grandTotal/e.totalCount;return t&&(e.total=0,e.count=0),i}},MAX:{name:"MAX",init:function(e){e.max=null,e.overallMax=null},add:function(e,t){"NUMBER"===e.dataType?t=k(t,e.formatMask):t.d&&(t=t.d),null===t||""===t.toString().trim()||isNaN(t)||((null===e.max||t>e.max)&&(e.max=t),(null===e.overallMax||t>e.overallMax)&&(e.overallMax=t))},get:function(e,t){const i=t?e.max:e.overallMax;return t&&(e.max=null),i}},MIN:{name:"MIN",init:function(e){e.min=null,e.overallMin=null},add:function(e,t){"NUMBER"===e.dataType?t=k(t,e.formatMask):t.d&&(t=t.d),null===t||""===t.toString().trim()||isNaN(t)||((null===e.min||t<e.min)&&(e.min=t),(null===e.overallMin||t<e.overallMin)&&(e.overallMin=t))},get:function(e,t){const i=t?e.min:e.overallMin;return t&&(e.min=null),i}},MEDIAN:{name:"MEDIAN",init:function(e){e.values=[],e.allValues=[]},add:function(e,t){t=k(t,e.formatMask),isNaN(t)||(e.values.push(t),e.allValues.push(t))},get:function(e,t){const i=t?e.values:e.allValues,n=i.length;let s;return i.sort((function(e,t){return e-t})),s=n%2==0?(i[n/2]+i[n/2-1])/2:i[(n-1)/2],t&&(e.values=[]),s}},COUNT:{name:"COUNT",init:function(e){e.count=0,e.totalCount=0},add:function(e,t){t.v&&(t=t.v),null!==t&&""!==t.toString().trim()&&(e.count+=1,e.totalCount+=1)},get:function(e,t){const i=t?e.count:e.totalCount;return t&&(e.count=0),i}},COUNT_DISTINCT:{name:"COUNT_DISTINCT",init:function(e){e.count=0,e.totalCount=0,e.distinctValues={}},add:function(e,t){t.v&&(t=t.v),null!==t&&""!==t.toString().trim()&&(e.distinctValues[t]||(e.count+=1,e.totalCount+=1),e.distinctValues[t]=1)},get:function(e,t){var i=t?e.count:e.totalCount;return t&&(e.count=0),i}}},re={modelId:function(){return null===this.instance?this.name:[this.name,this.instance]},_addToFetchRequest:function(e,t){let n,s,r=this,l=this._options;if(l.shape===d){let e,i=null,s=(c=t,u=l.pageSize,Math.floor(c/u)*u);if(t=function(e){let t,i=r._data;for(t=e;t<i.length&&void 0!==i[t];t++);return t}(s),this._haveAllData&&t>=this._data.length||this._masterRecordIsInserted||this._masterRecordIsDeleted)return!1;if(l.paginationType===v&&0!==t)return!1;e=this._getServerOffset(t),l.paginationType!==v&&(i=s+l.pageSize-e,i<l.pageSize&&void 0===this._data[s+l.pageSize]&&(i+=l.pageSize)),n={version:l.version,firstRow:e+1,maxRows:i}}else{if(l.shape===o&&this._haveAllData)return!1;n={version:l.version}}var c,u;if(this._requestsInProgress.fetch)return null;if(s=A({},l.regionData,{id:l.regionId,ajaxIdentifier:l.ajaxIdentifier,fetchData:A({},l.fetchData,n)}),e.regions||(e.regions=[]),e.regions.push(s),l.pageItemsToSubmit){let t,i=e.pageItems;i?S(i)||(i=E(i),e.pageItems=i):(i=[],e.pageItems=i),t=l.pageItemsToSubmit,S(t)||(t=E(t));for(let e=0;e<t.length;e++)i.includes(t[e])||i.push(t[e])}return this._addParentItems(s),this._requestsInProgress.fetch=!0,function(e){e.done((function(e){let n=!1;if(delete r._requestsInProgress.fetch,!r._destroyed){if(e.regions)for(let i=0;i<e.regions.length;i++){let s=e.regions[i];if(s.id===l.regionId){let e=null,i=null,h=null,c=null,u=null;s=s.fetchedData,l.shape===d?(e=s.values,i=s.totalRows,h=s.firstRow-1,c=s.moreData,u=s.dataOverflow):l.shape===a?e=s.root:l.shape===o&&(e=s.value),(e||l.shape===o)&&(r._addData(t,h,e,i,c,u),n=!0)}}if(!n){let t=H(h);i.error("Failed to fetch data.",t),e.error=t}}})).fail((function(){delete r._requestsInProgress.fetch}))}},fetch:function(e,t,i){let n,s,r,l,d=this._options,a=K(),o={};return"number"!=typeof e&&(i=t,t=e,e=0),s=this._addToFetchRequest(o,e),s?(l=A({},d.requestOptions),i?delete l.loadingIndicator:l.loadingIndicator=$(this),n=this._callServer(o,l),s(n),n.done((e=>{e.error?a.reject(e.error):e.errors?a.reject(e.errors):a.resolve()})).fail(((e,t,i)=>{a.reject(H("Error fetching data.",e,0,i))})),r=a.promise(),r.always((e=>{this._destroyed||(t&&t(e),this._drainWaiters(e))})),r):s},fetchAll:function(e){const t=this,i=this._options,n=i.pageSize;let s=0;if(i.shape!==d)throw X("fetchAll");for(;this._data[s];)s+=1;!function i(){var r=t.fetch(s,(function(r){r?e({error:r}):(e({offset:s,total:t.getTotalRecords(),done:!1}),s+=n,i())}),!0);null===r?setTimeout((function(){i()}),500):!1===r&&e({offset:s,total:t.getTotalRecords(),done:!0})}()},fetchRecords:function(e,t){let n,s,r,l,d,a=this._options,c=[],u=K();if(a.shape===o)throw X("fetchRecords");if(void 0===this._identityKeys)throw Q();for(let t=0;t<e.length;t++){let i=this._getIdentity(e[t]),n=this.getRecordMetadata(i);n&&!n.inserted&&c.push({recordId:i,pk:this._getPrimaryKey(e[t])})}return 0===c.length?null:(d=A({},a.regionData,{id:a.regionId,ajaxIdentifier:a.ajaxIdentifier,fetchData:A({},a.fetchData,{version:a.version,primaryKeys:c})}),r={regions:[d]},a.pageItemsToSubmit&&(r.pageItems=a.pageItemsToSubmit),this._addParentItems(r.regions[0]),l=B(a,this),n=this._callServer(r,l),n.done((e=>{let t;if(!this._destroyed){if(e.regions&&e.regions.length>0){let i=e.regions[0];i.fetchedData&&i.id===a.regionId&&(t=i.fetchedData.values)}if(t)this._updateData(t),u.resolve();else{let e=H(h);i.error("Failed update data.",e),u.reject(e)}}})).fail((function(e,t,i){u.reject(H("Error fetching records.",e,0,i))})),s=u.promise(),t&&s.always(t),s)},save:function(e){let t,i,n,s=B(this._options,this),r=K(),l={};return i=this.addChangesToSaveRequest(l),i?(t=this._callServer(l,s),i(t),t.done((function(e){e.errors?r.reject(e.errors):e.error?r.reject(e.error):r.resolve(null,e)})).fail((function(e,t,i){r.reject(H("Error saving data.",e,0,i))})),n=r.promise(),e&&n.always(e),n):null},saveInProgress:function(){return!!this._requestsInProgress.save},addChangesToSaveRequest:function(e){let t,s,r,l,d,a,o,c=this,u=this._options,f=this._metaKey,g=[],_=[],p={},y=[],I=0;function m(){delete c._requestsInProgress.save,c._changes=c._pendingChanges.concat(c._changes)}function v(e){let t,i,n,s,r,l,d=e.record;r=e.inserted&&!e.originalId,t=u.recordIsArray?[]:{};for(let s=0;s<_.length;s++)n=_[s],i=d[n],null!==i&&O(i)&&(i=i.v),l=p[n],e.fields&&e.fields[l]&&e.fields[l].disabled&&(i=""),!r||!c.isIdentityField(l)||e.original&&i!==e.original[n]||(i=""),"string"==typeof i&&(i=i.replace(/\n/g,"\r\n")),u.recordIsArray?t.push(N(i)):t[n]=N(i);s=null,e.deleted?s="d":e.inserted?s="i":e.updated&&(s="u"),t[f]||(t[f]={}),s&&(t[f].op=s),t[f].recordId=c._getIdentity(d),e.originalId&&(t[f].originalId=e.originalId),u.saveSelection&&(t[f].sel=e.sel?"Y":"N"),y.push(t)}if(u.pageItemsToSubmit){let t,i=e.pageItems;if(i||(i=[],e.pageItems=i),S(i)){t=u.pageItemsToSubmit,S(t)||(t=E(t));for(let e=0;e<t.length;e++)i.includes(t[e])||i.push(t[e])}}if(this._requestsInProgress.save||0===this._changes.length&&!u.saveSelection)return null;for(let e in u.fields)M(u.fields,e)&&(t=u.fields[e],t.virtual||(I+=1),t.volatile||t.virtual||(s=u.recordIsArray?t.index:e,_.push(s),p[s]=e,u.recordIsArray&&t.index===this._metaKey&&(f=_.length-1)));u.recordIsArray&&_.sort((function(e,t){return e-t})),f||(f=u.recordIsArray?_.length:"_meta");for(let e=0;e<this._changes.length;e++)r=this._changes[e],r.autoInserted&&!r.updated&&g.push(r.record);g.length&&this.deleteRecords(g);for(let e=0;e<this._changes.length;e++)r=this._changes[e],v(r);if(this._pendingChanges=this._changes,this._changes=[],u.saveSelection)for(const e of this._selection.values())e.inserted||e.deleted||e.updated||v(e);l=e.regions,l||(e.regions=l=[]);for(let e=0;e<l.length&&(d=l[e],d.id!==u.regionId);e++)d=null;return d||(d=A({},u.regionData,{id:u.regionId,ajaxIdentifier:u.ajaxIdentifier,saveData:{models:[]}}),l.push(d)),a=d.saveData.models,o=A({},u.saveData,{instance:this.instance,version:u.version,values:y}),this._addParentItems(o),a.push(o),this._requestsInProgress.save=!0,function(e){e.done((function(e){let t,s;if(!c._destroyed){if(e.errors){for(let t=0;t<e.errors.length;t++){let i=e.errors[t],s=i.message;i.unsafe||(s=n.unescapeHTML(s)),i.regionStaticId===u.regionStaticId&&i.recordId&&i.instance==c.instance&&c.setValidity("error",i.recordId,i.columnName||null,s)}m()}else if(e.regions){let n,r=!1,l=null;for(let i=0;i<e.regions.length;i++){if(t=e.regions[i],t.id===u.regionId){n=t.fetchedData.models;for(let e=0;e<n.length;e++)if(n[e].instance==c.instance){l=n[e].values,c._metaKey||(s=u.recordIsArray?I:"_meta"),l&&(c._updateData(l,s),r=!0);break}break}t=null}if(!r){let t=H(h);i.error("Failed update data after save.",t),e.error=t}c._clearChanges("_pendingChanges")}delete c._requestsInProgress.save}})).fail((function(){m()}))}},setData:function(e,t=0,i=null,n=!1){null===i&&e&&!n&&(i=e.length),this._addData(t,t,e,i,n,!1),0!==t&&null!==t||j(this,c,{})},clearData:function(e=!0){let t=this._requestsInProgress;return!t.fetch&&!t.save&&(this._clear(),e&&j(this,c,{}),!0)},getTotalRecords:function(e){let t=this._options;return t.shape===d?this._haveAllData||t.paginationType===v?this._data.length:this._totalRecords<0&&!0!==e?this._totalRecords:Math.max(this._data.length,this._totalRecords):t.shape===o?e&&null===this._data?0:1:t.shape===a?this._index.size:void 0},getServerTotalRecords:function(){const e=this._options;return e.shape===d?this._totalRecords<0?this._totalRecords:this._totalRecords+this._numInsertedRecords-this._numDeletedRecords:e.shape===o?1:e.shape===a?-1:void 0},getDataOverflow:function(){return!!this._dataOverflow},forEach:function(e,t){const i=this._options,n=this._data;if(i.shape===o)throw X("forEach");if(i.shape===a){let i=0;n&&this.walkTree(n,{node:n=>{U(t,e,n,i,this._getIdentity(n)),i+=1}})}else{const i=n.length;for(let s=0;s<i;s++){let i=n[s];i&&U(t,e,i,s,this._getIdentity(i,s))}}},transform:function(e,t){var i,n,s,r,l,d=/^\[\W*([^ \t/]+)\W*]$/,a=e.template,o=e.showNullAs,h=a.length,c=[],u={},f=this;function g(e,t){var i;return(i=e[t])||(i={values:{},paths:[]},e[t]=i),i}function _(e,t,i,n,s,r){var l,a,o,h,c,u,f,_;if(e){for(c=e.split("/"),u=n,f=null,_=null,o=null,l=0;l<c.length;l++){if(o=c[l],a=d.exec(o)){g(r,a[1]).paths[t]=c.slice(l+1).join("/");break}f=u,_=o,M(u,o)||(u[o]={}),u=u[o]}f?(S(f[_])?(h=f[_]).length=0:h=[],f[_]=h):h=n,s[t]=h}else{if(!S(n))throw new Error("Context must be an array when there is no path");s[t]=n}i&&g(r,i)}function p(e,i,n,s){var r,l,d,a,h=!1;return"string"==typeof e?(r=e.length,d=e.charAt(0),a=e.charAt(r-1),"'"===d&&"'"===a?e.substring(1,r-1):("("===d&&")"===a&&(e=e.substring(1,r-1),h=!0),null!==(l=f.getValue(i,e))&&"object"==typeof l&&M(l,"d")&&(l=h?l.v:l.d),h||!o||null!==l&&""!==l||(l=o),l)):C(e)?e.call(t,f,i,n,s):null===e?e:S(e)?function(e,t,i,n,s){var r,l;for(r=0;r<e.length;r++)void 0!==(l=p(e[r],i,n,s))&&(t[r]=l);return t}(e,[],i,n,s):"object"==typeof e?function(e,t,i,n,s){var r,l;for(r in e)M(e,r)&&void 0!==(l=p(e[r],i,n,s))&&(t[r]=l);return t}(e,{},i,n,s):void 0}function y(e,t,i,n){var s,r,l,a=[];if(e)for(e=e.split("/"),s=0;s<e.length;s++)r=e[s],(l=d.exec(r))&&a.push({key:l[1],value:p(l[1],t,i,n)});return a}function I(i,n,s){var d,o,I,m,v,R,x,w,b,F,M;if(!(n<r||l>0&&n>=r+l)&&(e.includeAggregates||!f._metaKey||!i[f._metaKey].agg)&&(!e.filter||e.filter.call(t,f,i,n,s)))for(d=0;d<h;d++)if(R=null,I=a[d],m=c[d],!I.filter||I.filter.call(t,f,i,n,s)){if(I.uniqueIndexField&&(R=u[I.uniqueIndexField],x=p(I.uniqueIndexField,i,n,s),void 0!==R.values[x]))continue;if(void 0!==(v=p(I.item,i,n,s))){if(R)R.values[x]={index:m.length,arrays:[],indexes:{}};else for(w=y(I.path,i,n,s),M=u,o=0;o<w.length;o++)void 0===(b=(R=g(M,w[o].key)).values[w[o].value])&&(b={index:m.length,arrays:[],indexes:{}},F=""===R.paths[d]?[]:{},m.push(F),R.values[w[o].value]=b),F=m[b.index],b.arrays[d]||_(R.paths[d],d,null,F,b.arrays,b.indexes),m=b.arrays[d],M=b.indexes;m.push(v)}}}for(null!==t&&"object"==typeof t||(t={}),function(){var e,i;for(e=0;e<a.length;e++)_((i=a[e]).path,e,i.uniqueIndexField,t,c,u)}(),r=0,e.offset>=0&&(r=e.offset),l=e.fetchData?this._options.pageSize:null,e.count>0&&(l=e.count),e.fetchData?this.forEachInPage(r,l,I):this.forEach(I),i=0;i<h;i++)n=a[i],s=c[i],n.sort&&s.array.sort(n.sort);return t},forEachInPage:function(e,t,n,s){var r,l,a,o,h=e,c=this,u=this._options,f=this._data;function g(r){var l=t-(r-e);i.trace("Model: "+c.modelId()+". forEachInPage fetching more data starting at: ",r),c._waitingPages.push({offset:r,callback:n,thisArg:s,next:function(){c.forEachInPage(r,l,n,s)}}),c._requestsInProgress.fetch||c.fetch(r,(function(e){e||setTimeout((function(){c._waitingPages.length>0&&c._waitingPages.shift().next()}),1)}))||(c._waitingPages.pop(),U(s,n,null,-1,null))}if(u.shape!==d)throw X("forEachInPage");if(t>u.pageSize&&(u.pageSize=10*Math.floor((t+9)/10)),u.paginationType===m&&(h=e-this._offset),h<0||h>=f.length)this._haveAllData?(U(s,n,null,-1,null),this._drainWaiters()):g(e);else{for(l=h+t,o=e,r=h;r<l;r++){if(void 0===(a=f[r]))return void(this._haveAllData&&r>=f.length?(U(s,n,null,-1,null),this._drainWaiters()):g(r+this._offset));a&&(U(s,n,a,o,this._getIdentity(a,r)),o+=1)}this._drainWaiters()}},indexOf:function(e){const t=this._options.shape;if(t===o)throw X("indexOf");if(e&&void 0!==this._identityKeys){let i=this.getRecordMetadata(this._getIdentity(e));if(t===a)return i&&i.parent?i.parent[this._childrenKey].indexOf(e):-1;if(i)return i.index}return this._data.indexOf(e)},recordAt:function(e){if(this._options.shape!==d)throw X("recordAt");return this._data[e]||null},getRecordId:function(e){return this._getIdentity(e)},getAggregateRecord:function(e,t){var i,n,s,r,l=null;if(t>=0){if(s=this._breakEndIds[t],(i=this.indexOf(this.getRecord(s)))>=0)for(r=!1;i<this._data.length;i++)if((n=(l=this._data[i])[this._metaKey])&&n.agg){if(r=!0,n.agg===e)break}else if(r){l=null;break}}else for(i=this._data.length-1;i>=0;i--){if(!((n=(l=this._data[i])[this._metaKey])&&n.agg&&n.grandTotal)){l=null;break}if(n.agg===e)break}return l},isIdentityField:function(e){return void 0!==this._identityKeys&&this._identityKeys.includes(this.getFieldKey(e))},getRecordMetadata:function(e){const t=this._options;let i,n;return n=e||t.shape!==o?W(e):t.identityField?this.getRecordId(this._data):"0",i=this._index.get(n),i||null},metadataChanged:function(e,t=null,i=null){let n=this._index.get(W(e));n&&j(this,"metaChange",{record:n.record,recordId:e,field:t,property:i})},getTypeMetadata:function(e){return this._options.types[e]||null},getFieldMetadata:function(e){return this._options.fields[e]||null},getFieldKey:function(e){const t=this._options;if(M(t.fields,e)&&!t.fields[e].virtual)return t.recordIsArray?t.fields[e].index:e},isChanged:function(){let e=0;if(0===this._changes.length)return!1;for(let t=0;t<this._changes.length;t++){let i=this._changes[t];i.autoInserted&&!i.updated||(e+=1)}return e>0},getChanges:function(){return this._changes},clearChanges:function(){this._clearChanges("_changes")},hasErrors:function(){return this._errors.length>0},getErrors:function(){return this._errors},setHiddenState:function(e,t){let i=this.getRecordMetadata(e);i&&i.hidden!==t&&(i.hidden=t,this.metadataChanged(e,null,"hidden"))},updateVisibility:function(e=null){const t=this._options,i=t.visibilityFilter;if(i){null!==e&&(t.visibilityFilterContext=e);let n=this,s=t.visibilityFilterContext;if(null===s)return;if(t.shape===a){let e=[];n.walkTree(n.root(),{node:function(t){if(!1===n.hasChildren(t)){let r=i(n,t,s);n.setHiddenState(n.getRecordId(t),!r),r&&(e[e.length-1]=r)}},beginChildren:function(){e.push(null)},endChildren:function(t){let r=!1,l=e.pop();0===e.length&&(r=!0,l=!0),null===l&&(l=i(n,t,s)),n.setHiddenState(n.getRecordId(t),!l),l&&!r&&(e[e.length-1]=l)}},null)}else t.shape===d&&n.forEach((function(e,t,r){let l=i(n,e,s);n.setHiddenState(r,!l)}))}},setDisabledState:function(e,t){let i=this.getRecordMetadata(e);i&&i.disabled!==t&&(i.disabled=t,this.metadataChanged(e,null,"disabled"))},setSelectionState:function(e,t,i="set"){let n,s,r;const l=(e,t)=>{let i=!1;for(let l=e;l<t;l++)r=this._data[l],r?(n=this._getIdentity(r,l),s=this._index.get(n),s&&!s.agg&&(s.sel=!0,this._selection.set(n,s))):i=!0;return i};if("all"===i)l(0,this._data.length),this._selectAll=!0;else if(n=W(e),s=this._index.get(n),s){if(t=!!t,this._selectAll&&["set","range"].includes(i)&&this.clearSelection(),"range"===i){let e,t,i,n=s.index;s=this._index.get(this._selectAnchor),s&&(t=s.index,n>t&&(e=n,n=t,t=e),i=l(n,t+1),i&&(this._selectRange=[n,t]))}else s.sel!==t&&(s.sel=t,t?(this._selection.set(n,s),this._selectAllExcept.delete(n)):(this._selection.delete(n),this._selectAll&&this._selectAllExcept.add(n))),this._selectAnchor=n,"toggle"!==i&&(this._selectRange=null);if(!this._selectAll){let e=this._totalRecords>=0?this.getServerTotalRecords():this.getTotalRecords(!0)-this._numAggregateRecords;this.getSelectedCount()===e&&(this._selectAll=!0)}}},clearSelection:function(){for(const e of this._selection.values())e.sel=!1;this._selection.clear(),this._selectAll=!1,this._selectRange=null,this._selectAllExcept.clear()},getSelectedCount:function(){let e=this._selection.size;if(this._selectAll)e=this._totalRecords>=0?this.getServerTotalRecords():this.getTotalRecords(!0)-this._numAggregateRecords,e-=this._selectAllExcept.size;else if(this._selectRange){let t=0,i=this._selectRange[0],n=this._selectRange[1]+1;for(let e=i;e<n;e++)this._data[e]||(t+=1);e+=t}return e},getSelectedRecords:function(){return[...this._selection.values()].sort(((e,t)=>e.index-t.index)).map((e=>e.record))},getSelectionState:function(){return{selectAll:this._selectAll,records:this.getSelectedRecords(),except:[...this._selectAllExcept],count:this.getSelectedCount(),rangeAnchor:this._selectAnchor}},allowEdit:function(e){return this.check("canEdit",e)},allowDelete:function(e){const t=this._options;if(t.shape===o||t.shape===a&&e===this._data)return!1;if(t.shape===a){let t=!0,i=!1;if(this.walkTree(e,{node:e=>{if(i&&t&&(this.check("canDelete",e)||(t=!1)),!t)return!0},beginChildren:()=>{i=!0}}),!t)return!1}return this.check("canDelete",e)},allowAdd:function(e,t,i){const n=this._options;let s,r,l;if(n.shape===o)return!1;if(!(n.shape!==a||e&&e[this._childrenKey]))return!1;if(r=this.check("canAdd",e,t,i),r&&i&&n.shape===a&&(l=this._getType(e),s=void 0!==l.validChildren?l.validChildren:void 0===n.types.default.validChildren||n.types.default.validChildren,!0!==s))for(let e=0;e<i.length;e++)if(!s.includes(i[e][this._typeKey])){r=!1;break}return r},allowDrag:function(e){return this._options.shape!==o&&this.check("canDrag",e)},dragOperations:function(e){const t=this._options;let i,n;if(e){if(e.length>0&&this._typeKey){n=e[0][this._typeKey]||"default";for(let t=1;t<e.length;t++)if((e[t][this._typeKey]||"default")!==n){n="default";break}}else n="default";i=t.types[n].operations&&void 0!==t.types[n].operations.drag?t.types[n].operations.drag:t.types.default.operations.drag}else i=t.types.default.operations.externalDrag;return i},check:function(e,t,i,n){const s=this._options,r=this._getType(t);let l,d=!1;if(!s.editable||this._masterRecordIsDeleted)return!1;if(t&&(l=this.getRecordMetadata(this._getIdentity(t)),l)){if(l.deleted||l.agg)return!1;if(l.inserted&&("canEdit"===e||"canDelete"===e))return!0}return l&&void 0!==l[e]?d=l[e]:r.operations&&void 0!==r.operations[e]?d=r.operations[e]:void 0!==s.types.default.operations[e]&&(d=s.types.default.operations[e]),C(d)&&(d=d.call(this,t,i,n)),C(s.check)&&(d=s.check(d,e,t,i,n)),d},isDisabled:function(e,t){const i=this._options,n=this._getType(e);let s=!1;if(t){if(t.record!==e)throw new Error("Record metadata doesn't match record")}else t=this.getRecordMetadata(this.getRecordId(e));return null!=t.disabled?s=t.disabled:void 0!==n.isDisabled?s=n.isDisabled:void 0!==i.types.default.isDisabled&&(s=i.types.default.isDisabled),s},getValue:function(e,t){return void 0===t&&(t=e,e=this._data),e[this.getFieldKey(t)]},setValue:function(e,t,i,n){var s,r,l,d,o,h,c,u,f,g,_,p,I,m=this._options,v=!1;if(void 0===i&&(i=t,t=e,e=this._data),l=this.getFieldKey(t),!this.allowEdit(e))throw new Error("Set value not allowed for record");if(c=this._getIdentity(e),!(d=this.getRecordMetadata(c)))return null;if(I=m.fields[t],void 0===l||I.readonly&&!I.parentField||d.fields&&d.fields[t]&&d.fields[t].ck)throw new Error("Set value not allowed for field");if(r=e[l],!T(r,i)){if(!n&&(t===m.sequenceField||t===m.parentIdentityField))if(u=f=g=null,t===m.sequenceField){if(m.shape===a?(f=this.parent())&&(u=f[this._childrenKey]):u=this._data,u){let t=parseFloat(i);for(s=0;s<u.length&&!(parseFloat(u[s][this._sequenceKey])>t);s++)g=u[s];g===e&&(g=null)}}else t===m.parentIdentityField&&(f=this.getRecord(i));if(d.original||(d.original=function(e){let t,i;if(S(e))for(i=[],t=0;t<e.length;t++)i[t]=N(e[t]);else for(t in i={},e)M(e,t)&&(i[t]=N(e[t]));return i}(e),v=!0),e[l]=i,(h=this._getIdentity(e))!==c){if(this._index.has(h))return e[l]=r,v&&delete d.original,"DUP";d.originalId||(d.originalId=c),this._index.delete(c),this._index.set(h,d),d.sel&&(this._selection.delete(c),this._selection.set(h,d))}return d.updated||d.deleted||d.inserted||this._addChange(d),m.trackChanges&&(d.updated=!0),d.fields||(d.fields={}),(o=d.fields[t])||(o={},d.fields[t]=o),m.trackChanges&&(o.changed=!0),(d.error||d.warning)&&this.setValidity("valid",h),j(this,y,{oldValue:r,oldIdentity:h!==c?c:null,recordId:h,record:e,field:t}),this._checkAggregates(t),(_=this._dependentFields[t])&&(I.calcValue&&((p={})[t]=1),ie(this,d,_,!0,p)),(f||g)&&this.moveRecords([e],f,g),"SET"}return"NC"},getRecordValue:function(e,t){return this.getValue(this.getRecord(e),t)},setRecordValue:function(e,t,i){this.setValue(this.getRecord(e),t,i)},setValidity:function(e,t,i,n){let s,r,l,d,a,o,h,c=this._index.get(W(t));if(c&&(i?(c.fields||(c.fields={}),r=c.fields[i],r||(r={},c.fields[i]=r)):r=c,a="valid",o=r.message||n,r.warning&&(a="warning"),r.error&&(a="error"),e!==a||o!==n)){switch(h="message",e){case"error":s="error",delete r.warning;break;case"warning":s="warning",delete r.error;break;case"valid":delete r.error,delete r.warning,delete r.message;break;default:throw new Error("Invalid value for pValidity parameter: "+e)}if(e!==a&&("valid"!==a&&(h+=","+a),s&&(h+=","+s)),s&&(r[s]=!0,r.message=n),l=c.error,!l&&c.fields)for(let e in c.fields)if(M(c.fields,e)&&c.fields[e].error){l=!0;break}l?(d=this._errors.indexOf(c),d>=0&&this._errors.splice(d,1),this._errors.push(c)):this._removeError(c),this.metadataChanged(t,i,h)}},deleteRecords:function(e){const t=this._options,n=[],s=[],r=[];let l=-1;if(t.shape===o)throw X("deleteRecords");for(let s=0;s<e.length;s++){let r=e[s],l=this._getIdentity(r);this.getRecordMetadata(l)?this.allowDelete(r)?t.shape===a?this.walkTree(r,{postNode:e=>{n.push(e)}}):n.push(r):i.warn("Delete not allowed for record: "+l):i.warn("Record to delete not found: "+l)}for(let e=0;e<n.length;e++){const i=n[e],a=this._getIdentity(i),o=this.getRecordMetadata(a);t.shape===d&&(this._numDeletedRecords+=1),t.onlyMarkForDelete&&!o.inserted||(t.shape===d&&o.inserted&&(this._numDeletedRecords-=1,this._numInsertedRecords-=1),this._removeRecord(a,o),t.shape===d&&(-1===l||o.index<l)&&(l=o.index)),o.inserted?(delete o.inserted,delete o.autoInserted,delete o.updated,this._removeError(o),this._removeChange(o)):(G(o,!0),this._removeError(o),t.trackChanges&&(o.deleted=!0),this._addChange(o)),s.push(i),r.push(a)}return l>=0&&this._resequenceServerOffset(l),s.length>0&&(j(this,_,{records:s,recordIds:r}),this._checkAggregates()),s.length},canRevertRecord:function(e){const t=this.getRecordMetadata(this._getIdentity(e));return!(!t||!t.original&&!t.deleted)},revertRecords:function(e){const t=this._options;let n={},s=[],r=[];for(let l=0;l<e.length;l++){let h,c,u=e[l],f=this._getIdentity(u),g=this.getRecordMetadata(f);g?g.original||g.deleted?(t.shape===d?(h=this._data,c=g.index):t.shape===a&&(h=this.parent(g.record)[this._childrenKey],c=h.indexOf(g.record)),g.deleted?(t.shape===d&&(this._numDeletedRecords-=1),delete g.deleted):(g.originalId&&(this._index.set(g.originalId,g),this._index.delete(f),g.sel&&(this._selection.set(g.originalId,g),this._selection.delete(f)),n[f]=g.originalId,delete g.originalId),g.original&&(g.record=g.original,delete g.original),delete g.updated),G(g),this._removeError(g),this._removeChange(g),u=g.record,t.shape!==o&&h[c]!==u&&(h[c]=u),s.push(u),r.push(f)):i.warn("Nothing to revert for record "+f):i.warn("Record to revert not found: "+f)}return s.length>0&&(j(this,f,{records:s,recordIds:r,newIds:n}),this._checkAggregates()),s.length},insertNewRecord:function(e,t,i){const n=this._options;let s,r,l,h,c,u,f=null;if(n.shape===o)throw X("insertNewRecord");if(h=this._initRecord(i,null,e),!this.allowAdd(e,"new",[h]))throw new Error("Insert not allowed for new record");if(n.shape===a?(u=e||this._data,c=u[this._childrenKey]):c=this._data,r=0,t&&(f=this._getIdentity(t),s=this.getRecordMetadata(f),s&&(r=n.shape===d?s.index+1:c.indexOf(s.record)+1)),this._sequenceKey){let e=parseFloat(h[this._sequenceKey])||null,[t,i]=L(c,r,this._sequenceKey);h[this._sequenceKey]=""+J(n.sequenceStep,t,i,1,1,e)}return c.splice(r,0,h),s={record:h},n.shape===d&&(this._reindex(r+1),s.index=r),l=this._getIdentity(h),n.trackChanges&&(s.inserted=!0),this._index.set(l,s),this._addChange(s),n.shape===a?s.parent=u:this._numInsertedRecords+=1,ne(this,s),j(this,"insert",{record:h,recordId:l,insertAfterId:f}),l},moveRecords:function(e,t,n){let s,r,l,d,h,c,u,f,g,_,p,y=this._options,I=[],m=[],v=null;if(y.shape===o)throw X("moveRecords");y.shape===a?(t||(t=this._data),l=t[this._childrenKey]):l=this._data,r=0,n&&(v=this._getIdentity(n),s=this.getRecordMetadata(v),s&&(r=l.indexOf(s.record)+1),(!s||r<0)&&(i.warn("AfterRecord not found, move to beginning."),r=0)),this._sequenceKey&&([f,g]=L(l,r,this._sequenceKey)),p=0,_=this._data.length;for(let n=0;n<e.length;n++)if(c=e[n],u=this._getIdentity(c),s=this.getRecordMetadata(u),s){if(y.shape===a){if(d=this.parent(c),!d){i.warn("Move not allowed for root");continue}d=d[this._childrenKey]}else d=l;if(h=d.indexOf(c),y.shape!==a&&(h>p&&(p=h),h<_&&(_=h)),d.splice(h,1),l===d&&h<r&&(r-=1),m.push(c),I.push(u),l.splice(r,0,c),y.shape!==a&&(r>p&&(p=r),r<_&&(_=r)),r+=1,this._sequenceKey){let t=parseFloat(c[this._sequenceKey])||null;this.setValue(c,y.sequenceField,""+J(y.sequenceStep,f,g,e.length,n+1,t),!0)}y.shape===a&&(s.parent=t,this._parentIdKey&&this.setValue(c,y.parentIdentityField,this._getIdentity(t),!0))}else i.warn("Record to move not found: "+u);return y.shape!==a&&(this._reindex(_,p+1),this._resequenceServerOffset(_)),j(this,"move",{records:m,recordIds:I,insertAfterId:v}),I},copyRecords:function(e,t,n){let s,r,l,d,h,c,u,f,g,_,p=this,y=this._options,I=[],m=[],v=null;if(y.shape===o)throw X("copyRecords");y.shape===a?(f={node:function(e,t){var i,n;t&&(i=p._getIdentity(e),n={record:e,inserted:!0,parent:t},p._index.set(i,n),p._addChange(n))}},t||(t=this._data),c=t[this._childrenKey]):c=this._data,r=0,n&&(v=this._getIdentity(n),s=this.getRecordMetadata(v),s&&(r=c.indexOf(s.record)+1),(!s||r<0)&&(i.warn("AfterRecord not found, copy to beginning."),r=0)),this._sequenceKey&&([g,_]=L(c,r,this._sequenceKey));for(let n=0;n<e.length;n++)l=e[n],h=this._getIdentity(l),s=this.getRecordMetadata(h),s?(d=this._initRecord(null,e[n],t),c.splice(r,0,d),this._sequenceKey&&(d[this._sequenceKey]=""+J(y.sequenceStep,g,_,e.length,n+1)),u=this._getIdentity(d),m.push(d),I.push(u),s={record:d,inserted:!0,index:r},this._index.set(u,s),this._addChange(s),y.shape===a?(s.parent=t,this.walkTree(d,f,null)):this._numInsertedRecords+=1,r+=1):i.warn("Record to copy not found: "+h);return this._reindex(r),j(this,"copy",{records:m,recordIds:I,insertAfterId:v}),this._checkAggregates(),I},root:function(){if(this._options.shape!==a)throw X("root");return this._data},child:function(e,t){const i=e[this._childrenKey];if(i)return i[t]},parent:function(e){if(this._identityKeys){let t=this._getIdentity(e),i=this.getRecordMetadata(t);if(i&&M(i,"parent"))return i.parent?i.parent:null}},childCount:function(e){const t=e[this._childrenKey];return null===t?null:t?t.length:0},hasChildren:function(e){const t=e[this._childrenKey];return null===t?null:!!t&&t.length>0},fetchChildNodes:function(e,t){let i,n,s,r,l,d=this._options,a=K();return l=A({},d.regionData,{id:d.regionId,ajaxIdentifier:d.ajaxIdentifier,fetchData:A({},d.fetchData,{version:d.version,parentId:e?this._getPrimaryKey(e):null})}),s={regions:[l]},d.pageItemsToSubmit&&(s.pageItems=d.pageItemsToSubmit),this._addParentItems(s.regions[0]),r=B(d,this),e&&delete r.loadingIndicator,i=this._callServer(s,r),i.done((t=>{if(this._destroyed)return;let i,n=t.regions[0].fetchedData;if(e){let t=n[this._childrenKey];this._addData(e,null,t),i=t.length}else this._addData(null,null,n.root),i=1;a.resolve(i)})).fail((function(e,t,i){a.reject(H("Error fetching child nodes.",e,0,i))})),n=a.promise(),t&&n.always(t),n},clearChildNodes:function(e){e[this._childrenKey]=null},walkTree:function(e,t,i){let n,s,r,l;if(e&&(void 0===i&&(i=null,n=this._getIdentity(e),n&&(s=this.getRecordMetadata(n),s&&(i=s.parent))),!t.node||(l=t.node(e,i),!l))){if(r=e[this._childrenKey],r&&r.length>0){t.beginChildren&&t.beginChildren(e);for(let i=0;i<r.length;i++)this.walkTree(r[i],t,e);t.endChildren&&t.endChildren(e)}t.postNode&&t.postNode(e,i)}},subscribe:function(e){let t=e.viewId;return t||(t="v::"+w,w+=1,e.viewId=t),this._listeners.push(e),t},unSubscribe:function(e){for(let t=0;t<this._listeners.length;t++)this._listeners[t].viewId===e&&this._listeners.splice(t,1)},getOption:function(e){const t=this._options[e];if(void 0===t)throw new Error("No such option: "+e);return t},setOption:function(e,t){const n=this._options;if(F.has(e)){if("editable"===e&&!n.identityField&&n.shape!==o)throw Q();"trackChanges"===e&&!t&&n.onlyMarkForDelete&&(n.onlyMarkForDelete=!1),"onlyMarkForDelete"===e&&!1===n.trackChanges&&(t&&i.warn(e+" cannot be true when trackChanges is false"),t=!1),n[e]=t}else i.warn("Option cannot be set: "+e)},_callServer:function(e,i){return(this._options.callServer||t.plugin)(e,i)},_drainWaiters:function(e){for(let t=0;t<this._waitingPages.length;t++){let i=this._waitingPages[t];if((this._haveAllData||this._data[i.offset]||e)&&(this._waitingPages.splice(t,1),t-=1,e&&0!==e.status?U(i.thisArg,i.callback,null,-1,null,e):i.next(),this._requestsInProgress.fetch))return}},_getServerOffset:function(e){var t,i,n,s=e-1;for(n=this._data[s];n;){if(t=this._getIdentity(n,s),(i=this.getRecordMetadata(t))&&i.serverOffset>=0)return i.serverOffset+1;s-=1,n=this._data[s]}return e},_clear:function(){let e=this._options;(this._requestsInProgress.fetch||this._requestsInProgress.save)&&i.error("Model cleared during ajax request"),this._haveAllData=!1,e.shape===d?(this._data=[],e.hasTotalRecords?this._totalRecords=0:this._totalRecords=-1,this._offset=0,this._numInsertedRecords=0,this._numDeletedRecords=0,this._numAggregateRecords=0,this._masterRecordIsInserted&&(this._haveAllData=!0),this._dataOverflow=!1):this._data=null,this._changes=[],this._errors=[],this._index.clear(),this._breakEndIds=[],this._selection.clear(),this._selectAll=!1,this._selectRange=null,this._selectAnchor=null,this._selectAllExcept.clear()},_saveDataState:function(){this._saveState={_data:this._data,_totalRecords:this._totalRecords,_haveAllData:this._haveAllData,_offset:this._offset,_numInsertedRecords:this._numInsertedRecords,_numDeletedRecords:this._numDeletedRecords,_numAggregateRecords:this._numAggregateRecords,_dataOverflow:this._dataOverflow,_changes:this._changes,_errors:this._errors,_index:this._index,_breakEndIds:this._breakEndIds,_selection:this._selection,_selectAll:this._selectAll,_selectRange:this._selectRange,_selectAllExcept:this._selectAllExcept},this._index=new Map,this._selection=new Map,this._selectAllExcept=new Set},_restoreDataState:function(){const e=this._saveState;this._data=e._data,this._totalRecords=e._totalRecords,this._haveAllData=e._haveAllData,this._offset=e._offset,this._numInsertedRecords=e._numInsertedRecords,this._numDeletedRecords=e._numDeletedRecords,this._numAggregateRecords=e._numAggregateRecords,this._dataOverflow=e._dataOverflow,this._changes=e._changes,this._errors=e._errors,this._index=e._index,this._breakEndIds=e._breakEndIds,this._selection=e._selection,this._selectAll=e._selectAll,this._selectRange=e._selectRange,this._selectAllExcept=e._selectAllExcept},_clearChanges:function(e){const t=[],i=[],n=this._options,s=this[e];let r=-1,l=!1;for(let e=0;e<s.length;e++){const a=s[e],o=this._getIdentity(a.record);a.deleted&&n.onlyMarkForDelete&&(this._removeRecord(o,a),n.shape===d&&(l=!0)),a.deleted?t.push(o):(a.inserted||a.updated)&&(i.push(o),a.inserted&&n.shape===d&&(a.serverOffset=0,l=!0)),l&&(-1===r||a.index<r)&&(r=a.index),delete a.deleted,delete a.recordId,delete a.inserted,delete a.autoInserted,delete a.updated,delete a.original}l&&this._resequenceServerOffset(r),this._totalRecords>=0&&(this._totalRecords+=this._numInsertedRecords,this._totalRecords-=this._numDeletedRecords),this._numInsertedRecords=0,this._numDeletedRecords=0,this[e]=[],j(this,p,{deletedIds:t,changedIds:i})},_reindex:function(e,t){const i=this._data;let n=i.length;null!=t&&t<n&&(n=t);for(let t=e;t<n;t++)if(void 0!==i[t]){let e=this._getIdentity(i[t]);this.getRecordMetadata(e).index=t}},_resequenceServerOffset:function(e=0){const t=this._data;let i,n,s=-1;for(;e>0&&(i=t[e-1],s=this.getRecordMetadata(this.getRecordId(i)).serverOffset,void 0===s);)e-=1;for(let r=e;r<t.length;r++)i=t[r],i?(n=this.getRecordMetadata(this.getRecordId(i)),n.serverOffset>=0&&(s+=1,n.serverOffset=s)):s+=1},_addData:function(e,t,n,s,r,l){const h=this._options,c=this,f=this._calculatedFields.length>0;let g,_,p,y,I,R,x,w,b,F,M,S;function D(e,t,i,n){const s={record:n};return c._metaKey&&(A(s,n[c._metaKey]),s.sel="Y"===s.sel,s.agg&&(!e||c._identityKeys&&!n[c._identityKeys[0]])&&(c._assignTempIdentity(n),e=c._getIdentity(n)),z(s)),null!=t&&(s.serverOffset=t),null!=i&&(s.index=i),s.agg&&(c._numAggregateRecords+=1),c._index.set(e,s),(s.sel||c._selectAll||c._selectRange&&i>c._selectRange[0]&&i<=c._selectRange[1])&&(s.sel=!0,c._selection.set(e,s)),h.visibilityFilter&&h.visibilityFilterContext&&(s.hidden=!h.visibilityFilter(c,n,h.visibilityFilterContext)),te(n,h.fields,h.recordIsArray),f&&!s.agg&&ne(c,s),s}function C(e,t,i){let n=0;for(let s=0;s<c._aggregateRecs.length;s++){let r,l,d,a,o=c._aggregateRecs[s];t[o]||(l=c._initRecord(!1),a=c._getIdentity(l),d={agg:o},i&&(d.grandTotal=i),l[c._metaKey]=d,r=e+n,c._data[r]?c._data.splice(r,0,l):c._data[r]=l,D(a,null,r,l),n+=1)}return n}function K(e,t,i,n,s){if(c._data.length>0&&c._haveAllData&&c._aggregateRecs.length>0){if(n){if(t&&t.grandTotal){for(e=c._data.length-1;e>=0&&(i=c._data[e],(t=c._metaKey&&i[c._metaKey])&&t.agg&&t.grandTotal);e--);e+=1}e+=C(e,s),c._reindex(e)}(e=C(c._data.length,s,!0))>0&&c._checkAggregates()}}if(h.shape===d?((0===e&&!this.isChanged()||h.paginationType===v)&&this._clear(),h.paginationType===m&&(this._offset=e),this._totalRecords=-1,null!=s?this._totalRecords=s:h.hasTotalRecords&&i.warn("Model missing total records"),this._haveAllData||r||(this._haveAllData=!0),l&&(this._dataOverflow=!0)):h.shape===o&&this._clear(),h.shape===a&&e)i.trace("Model: "+this.modelId()+". add data subtree: ",e),R=e,R[this._childrenKey]=n,h.identityField&&c.walkTree(R,{node:function(e,t){if(t){D(c._getIdentity(e),null,null,e).parent=t}}},null),j(this,u,{parentNode:R,offset:0,count:n.length});else if(null===this._data||0===this._data.length||h.shape!==d||h.paginationType===m){if(i.trace("Model: "+this.modelId()+". add data set: ",e,s,r),this._data=n,this._numInsertedRecords=0,this._numDeletedRecords=0,this._numAggregateRecords=0,h.shape!==o)if(b={offset:0,count:n.length},x=t,h.shape===a&&this.root())h.identityField&&this.walkTree(this.root(),{node:function(e,t){let i,n=c._getIdentity(e);c._metaKey&&e[c._metaKey].agg?w=null:(w=x,x+=1),i=D(n,w,null,e),i.parent=t}},null),b.parentNode=null,b.count=1;else{let e;for(M=!1,S={},e=0;e<this._data.length;e++)p=this._data[e],g=this._getIdentity(p,e),_=this._metaKey&&p[this._metaKey],_&&_.agg?(w=null,S[_.agg]=1):(w=x,x+=1,M&&(e+=C(e,S)),M=!1),_&&_.endControlBreak&&(this._breakEndIds.push(g),this._aggregateRecs.length>0&&(M=!0,S={})),D(g,w,e,p);K(e,_,p,M,S)}else this._data?(this._haveAllData=!0,b={offset:0,count:1},D(this._getIdentity(this._data),null,null,this._data)):(this._haveAllData=!0,b={offset:0,count:0});j(this,u,b)}else{let l;for(i.trace("Model: "+this.modelId()+". add data merge: ",e,s,r),y=e,x=t,F=[],M=!1,S={},l=0;l<n.length;l++){if(p=n[l],g=this._getIdentity(p,y),_=this._metaKey&&p[this._metaKey],_&&_.agg?(w=null,S[_.agg]=1):(w=x,x+=1),I=this.getRecordMetadata(g),I){if(I.updated||I.inserted||I.deleted)continue;this._data[I.index]=p,te(p,h.fields,h.recordIsArray),I.record=p,x-=1,_&&A(I,_),F.push(g),f&&!I.agg&&ne(this,I)}else this._data[y]?this._data.splice(y,0,p):this._data[y]=p,D(g,w,y,p),y+=1;_&&(_.agg||(M&&(y+=C(y,S)),M=!1),_.endControlBreak&&(this._breakEndIds.push(g),this._aggregateRecs.length>0&&(M=!0,S={})))}K(l,_,p,M,S),b={offset:e,count:y-e},F.length&&(b.replacedIds=F),j(this,u,b)}},_updateData:function(e,t){const i=this._options,n=[],s=[],r=[],l=[],d={},a=t||this._metaKey;let o=!1,h=-1;for(let o=0;o<e.length;o++){const c=e[o],u=c[a];let f,g,_=u?u.recordId:null;u&&_&&u.notFound?(f=this.getRecordMetadata(_),this._removeRecord(_,f),r.push(f.record),l.push(_),(-1===h||f.index<h)&&(h=f.index)):(g=this._getIdentity(c),_===g&&(_=null),f=this.getRecordMetadata(_||g),f&&(_&&(d[_]=g,this._index.set(g,f),this._index.delete(_),this._selection.delete(_),f.sel&&this._selection.set(g,f),(-1===h||f.index<h)&&(h=f.index),f.serverOffset=0),n.push(c),s.push(_||g),this._data[f.index]=c,te(c,i.fields,i.recordIsArray),f.record=c,a&&u?(A(!0,f,u),f.highlight&&void 0===u.highlight&&delete f.highlight,z(f),delete f.recordId):t&&(i.recordIsArray?c.splice(t,1):delete c[t]),i.visibilityFilter&&i.visibilityFilterContext&&(f.hidden=!i.visibilityFilter(this,c,i.visibilityFilterContext)),ne(this,f),delete f.deleted,delete f.inserted,delete f.autoInserted,delete f.updated,delete f.original,G(f),this._removeError(f),this._removeChange(f)))}h>=0&&this._resequenceServerOffset(h),n.length>0&&(j(this,g,{records:n,recordIds:s,newIds:d}),o=!0),r.length>0&&(this._totalRecords>=r.length&&(this._totalRecords-=r.length),j(this,_,{records:r,recordIds:l}),o=!0),o&&this._checkAggregates()},_initRecord:function(t,i,n){var s,r,l,d,o,h,c,u,f,g,_=!0,p=this._options;if(t)h=t;else for(s in!1===t&&(_=!1),h=p.recordIsArray?[]:{},p.fields)if(M(p.fields,s)&&(r=p.fields[s],l=p.recordIsArray?r.index:s,!r.virtual))if(!i||r.noCopy){if(r.parentField&&p.parentModel&&(c||(c=e.get(p.parentModel))&&!u&&p.parentRecordId&&(u=c.getRecord(p.parentRecordId)),u)){h[l]=c.getValue(u,r.parentField);continue}f="",_&&void 0!==(g=r.defaultValue)&&(f="function"==typeof g?g(this,i):g),h[l]=f}else this._identityKeys.includes(l)||(h[l]=i[l]);if(c&&e.release(p.parentModel),this._identityKeys&&this._assignTempIdentity(h),this._metaKey&&void 0===h[this._metaKey]&&(h[this._metaKey]={}),p.shape===a&&(this._parentIdKey&&(h[this._parentIdKey]=this._getIdentity(n)),o=[],h[this._childrenKey]=o,i&&(d=i[this._childrenKey])))for(s=0;s<d.length;s++)o.push(this._initRecord(null,d[s],h));return h},_assignTempIdentity:function(e){for(let t=0;t<this._identityKeys.length;t++)e[this._identityKeys[t]]||(e[this._identityKeys[t]]=this._options.genIdPrefix+P(this.name))},_getIdentity:function(e,t){let i=null;if(void 0!==this._identityKeys)if(1===this._identityKeys.length)i=e[this._identityKeys[0]]+"";else{i=[];for(let t=0;t<this._identityKeys.length;t++)i.push(e[this._identityKeys[t]]+"")}else null!=t?i=t+"":this._options.shape===o&&(i="0");return null!==i?W(i):i},_getPrimaryKey:function(e){var t,i;if(void 0!==this._identityKeys)for(i=[],t=0;t<this._identityKeys.length;t++)i.push(e[this._identityKeys[t]]+"");return i},_getType:function(e){let t="default",i=this._options;return e&&void 0!==this._typeKey&&(t=e[this._typeKey],null!==t&&O(t)&&(t=t.v),t||(t="default")),i.types[t]||i.types.default},_getRecordById:function(e){let t=this._index.get(W(e));return t?t.record:null},_removeRecord:function(e,t){const i=this._options;let n,s,r;i.shape===d?(n=this._data,r=t.index):i.shape===a&&(n=t.parent[this._childrenKey],r=n.indexOf(t.record),delete t.parent),n.splice(r,1),this._reindex(r),s=W(e),this._index.delete(s),t.sel&&this._selection.delete(s)},_addChange:function(e){if(!this._options.trackChanges)return;let t=this._changes.indexOf(e);t>=0&&this._changes.splice(t,1),this._changes.push(e)},_removeChange:function(e){if(!this._options.trackChanges)return;let t=this._changes.indexOf(e);t>=0&&!e.deleted&&!e.updated&&!e.inserted&&this._changes.splice(t,1)},_removeError:function(e){let t=this._errors.indexOf(e);t>=0&&this._errors.splice(t,1)},_addParentItems:function(t){var i,n,s,r,l,d,a={values:[]},o=this._options;if(o.parentModel&&o.parentRecordId){for(i in o.fields)M(o.fields,i)&&(n=o.fields[i]).parentField&&(s||(s=e.get(o.parentModel))&&!r&&(r=s.getRecord(o.parentRecordId),d=s.getRecordMetadata(o.parentRecordId)),r&&(l={n:n.parentField,v:s.getValue(r,n.parentField)},a.values.push(l)));d&&(d.salt&&(a.salt=d.salt),d.protected&&(a.protected=d.protected)),s&&e.release(o.parentModel),t.parentRecordId=o.parentRecordId,a.values.length>0&&(t.parentItems=a)}},_updateAggregates:function(){var e,t,i,n,s,l,d=this._options.fields,a=[];if(!(this._staleAggFields.length<=0)){for(e=0;e<this._staleAggFields.length;e++)for(i=d[n=this._staleAggFields[e]],t=0;t<i.aggregates.length;t++)"string"==typeof(s=i.aggregates[t])&&(s=se[s]),(l={name:s.name,fieldName:n,key:this.getFieldKey(this._staleAggFields[e]),state:{dataType:i.dataType,formatMask:i.formatMask},agg:s}).agg.init(l.state),a.push(l);this.forEach((function(e,t,i){var n,s,d,o=this.getRecordMetadata(i);for(n=0;n<a.length;n++)if(l=a[n],o.agg){if(o.agg===l.name){let t=l.state.dataType,n=l.state.formatMask;d=e[l.key],s=l.agg.get(l.state,!o.grandTotal)+"",s="NUMBER"===t&&n?r.formatNumber(s,n):""+s,e[l.key]=s,j(this,y,{oldValue:d,oldIdentity:null,recordId:i,record:e,field:l.fieldName})}}else o.deleted||(s=e[l.key],l.agg.add(l.state,s))}),this),this._staleAggFields=[]}},_checkAggregates:function(e){if(e)this._aggregatedFields[e]&&this._staleAggFields.indexOf(e)<0&&(this._staleAggFields.push(e),this._debouncedUpdateAggregates());else for(let e in this._aggregatedFields)M(this._aggregatedFields,e)&&this._checkAggregates(e)},_recalculate:function(e){this.forEach((function(t,i,n){const s=this.getRecordMetadata(n);s.agg||ie(this,s,e,!0)}),this)}},le={shape:d,recordIsArray:!1,hasTotalRecords:!1,genIdPrefix:"t",regionId:null,ajaxIdentifier:null,pageItemsToSubmit:null,regionData:{},fetchData:{},saveData:{},requestOptions:{},version:1,parentModel:null,parentRecordId:null,editable:!1,trackChanges:!0,onlyMarkForDelete:!0,identityField:null,typeField:null,childrenField:null,parentIdentityField:null,sequenceField:null,metaField:null,sequenceStep:10,saveSelection:!1,types:{default:{isDisabled:!1,validChildren:!0,operations:{canAdd:!0,canEdit:!0,canDelete:!0,canDrag:!0,drag:{normal:"move",ctrl:"copy"},externalDrag:{normal:"add"}}}},check:null,sortCompare:null,callServer:null,paginationType:v,pageSize:100,preFetch:!1,visibilityFilterContext:null,visibilityFilter:null},de=new Set([d,a,o]),ae=new Set([v,m,"progressive"]);function oe(e){const t=q(e);let i=R[t[0]];return i&&(i=t[1]?i.instances[t[1]]:i.model),i}function he(e,t,i,n){let s=n?q(n):null,r=[];function l(n){let r=!(!i&&!n._options.regionId);return r&&("change"===e?r=n.isChanged():"error"===e&&(r=n.hasErrors()),r&&t&&(r=function(e){let t,i=e,n=q(i.modelId());for(;n;){if(n[0]===s[0]&&(n[1]===s[1]||null===s[1]))return!0;n=null,t=i.getOption("parentModel"),t&&(i=oe(t),i&&(n=q(t)))}return!1}(n))),r}function d(e,t){r.push({id:e,model:t})}function a(e,t){e.model&&l(e.model)&&d(t,e.model);for(let i in e.instances)M(e.instances,i)&&l(e.instances[i])&&d([t,i],e.instances[i])}if(s||(t=!1),!t&&s&&s[0]){let e=s[0],t=R[e];t&&(s[1]?t.instances[s[1]]&&l(t.instances[s[1]])&&d([e,s[1]],t.instances[s[1]]):a(t,e))}else for(let e in R)if(M(R,e)){a(R[e],e)}return r}function ce(e){let t=x.indexOf(e);t>=0&&x.splice(t,1)}e.create=function(t,r,h,u,m,w){const F=q(t),D=Object.create(re);let C,K,T,k,E,O,V,P,N,U,z;function W(e,t){const n=C.fields[e];(n.calcValue||n.dependsOn||n.aggregates&&n.aggregates.length>0)&&(i.warn("Model "+t+" field does not support calculations"),delete n.calcValue,delete n.dependsOn)}if(D.name=F[0],D.instance=F[1],D._requestsInProgress={},D._listeners=[],D._waitingPages=[],K=r.fields,D._options=A(!0,{},le,r),D._options.fields=K,C=D._options,!C.fields)throw new Error("The fields option is required");if(!de.has(C.shape))throw new Error("Invalid shape option: "+C.shape);if(!ae.has(C.paginationType))throw new Error("Invalid paginationType option: "+C.paginationType);if(C.editable&&!C.identityField&&C.shape!==o)throw Q();if(C.shape===a&&!C.childrenField)throw new Error("A tree shaped model requires a childrenField");if(C.shape===d&&C.paginationType===v&&void 0===r.hasTotalRecords&&(C.hasTotalRecords=!0),!C.trackChanges&&C.onlyMarkForDelete&&(r.onlyMarkForDelete&&i.warn("Model forcing onlyMarkForDelete to false"),C.onlyMarkForDelete=!1),D._dependentFields={},D._calculatedFields=[],D._aggregatedFields={},D._aggregateRecs=[],function(e,t,i,r,d){let a,o,h,c,u,f,g,_=[],p={};const y=function(e){const t=e.target.id;D._recalculate(D._dependentFields[":"+t])};for(o in e)if(M(e,o)){if(h=e[o],h.calcValue&&i.push(o),c=h.dependsOn,c)for(let i=0;i<c.length;i++){if(f=c[i],":"===f.substr(0,1)){if(g=f.substr(1),!s(g).node)throw Z(o,g);_.push(g)}else if(!e[f])throw Z(o,f);I=o,t[m=f]||(t[m]=[]),t[m].push(I)}if(h.aggregates){for(let e=0;e<h.aggregates.length;e++){if(a=h.aggregates[e],"string"==typeof a&&!se[a]||"object"==typeof a&&!(a.name&&a.init&&a.add&&a.get))throw new Error(`Field '${o}' has invalid aggregate`);u=a.name||a,p[u]||d.push(u),p[u]=1}r[o]=1}}var I,m;_.length>0&&(D._externalItems$=l(_.map((e=>"#"+n.escapeCSS(e))).join(",")),D._externalItems$.on("change",y),D._externalItemsHandler=y)}(C.fields,D._dependentFields,D._calculatedFields,D._aggregatedFields,D._aggregateRecs),D._staleAggFields=[],D._debouncedUpdateAggregates=n.debounce((function(){D._updateAggregates()}),250),C.identityField)if(S(C.identityField)){D._identityKeys=[];for(let e=0;e<C.identityField.length;e++){if(D._identityKeys.push(D.getFieldKey(C.identityField[e])),void 0===D._identityKeys[e])throw ee("Identity",C.identityField[e]);W(C.identityField[e],"identity")}}else{if(D._identityKeys=[D.getFieldKey(C.identityField)],void 0===D._identityKeys[0])throw ee("Identity",C.identityField);W(C.identityField,"identity")}if(C.typeField){if(D._typeKey=D.getFieldKey(C.typeField),void 0===D._typeKey)throw ee("Type",C.typeField);W(C.typeField,"type")}if(C.childrenField){if(D._childrenKey=D.getFieldKey(C.childrenField),void 0===D._childrenKey)throw ee("Children",C.childrenField);W(C.childrenField,"children")}if(C.parentIdentityField){if(D._parentIdKey=D.getFieldKey(C.parentIdentityField),void 0===D._parentIdKey)throw ee("Parent identity",C.parentIdentityField);W(C.parentIdentityField,"parentIdentity")}if(C.sequenceField){if(D._sequenceKey=D.getFieldKey(C.sequenceField),void 0===D._sequenceKey)throw ee("Sequence",C.sequenceField);W(C.sequenceField,"sequence")}if(C.metaField){if(D._metaKey=D.getFieldKey(C.metaField),void 0===D._metaKey)throw ee("Meta",C.metaField);W(C.metaField,"meta")}if(C.shape!==o?C.identityField?D.getRecord=D._getRecordById:C.shape===d?D.getRecord=D.recordAt:D.getRecord=function(){return null}:D.getRecord=function(){return D._data},D._index=new Map,D._selection=new Map,D._selectAllExcept=new Set,D._clear(),h?(P=C.paginationType!==v&&(null!=m?m:null==u||h.length<u),D._addData(0,0,h,u,P,w)):(null!=u&&(D._totalRecords=u),C.shape===o&&!1===m&&(D._haveAllData=!0)),C.parentModel&&C.parentRecordId&&!h&&(z=e.get(C.parentModel),z)){U=z.getRecordMetadata(C.parentRecordId),U.inserted&&(D._masterRecordIsInserted=!0,D._clear()),U.deleted&&(D._saveDataState(),D._masterRecordIsDeleted=!0,D._clear(),D._addData(0,0,[],0,!1,!1)),E=D._parentFieldsMap={};for(let e in C.fields)M(C.fields,e)&&(k=C.fields[e],k.parentField&&(E[k.parentField]||(E[k.parentField]=[]),E[k.parentField].push(e)));D.parentModelViewId=z.subscribe({onChange:function(t,i){let n;if(t===_||t===f||t===g||t===p){n=i.recordIds||i.deletedIds;for(let s=0;s<n.length;s++)if(n[s]===C.parentRecordId){if(t===_)D._saveDataState(),D._masterRecordIsDeleted=!0,D._clear(),D._addData(0,0,[],0,!1,!1),j(D,c,{});else if(t!==f&&t!==g||!D._masterRecordIsDeleted)if(t===g&&i.newIds&&i.newIds[D.instance]){const t=i.newIds[D.instance];let n=[];C.parentRecordId=t,e.renameInstance(D.modelId(),t),D.forEach(((e,t,i)=>{let s=D.getRecordMetadata(i);s.autoInserted&&!s.updated&&n.push(s.record)})),n.length&&D.deleteRecords(n)}else t===p&&D._masterRecordIsDeleted&&delete D._saveState;else delete D._masterRecordIsDeleted,D._restoreDataState(),j(D,c,{});break}t===p&&D._masterRecordIsInserted&&delete D._masterRecordIsInserted}else t===y&&(i.oldIdentity||i.recordId)===C.parentRecordId?(O=i.field,O in E&&(T=E[O],V=z.getValue(i.record,O),D.forEach((function(e){let t;if(!D._metaKey||!e[D._metaKey].agg)for(let n=0;n<T.length;n++)t=T[n],i.oldValue===D.getValue(e,t)&&D.setValue(e,t,V)}))),i.oldIdentity&&(C.parentRecordId=i.recordId,e.renameInstance(D.modelId(),i.recordId))):t===c&&D._masterRecordIsDeleted?(delete D._masterRecordIsDeleted,D._restoreDataState(),j(D,c,{})):t===I&&(C.parentModel=null,D.parentModelViewId=null,delete D._masterRecordIsDeleted,delete D._masterRecordIsInserted)}}),e.release(C.parentModel)}return x.length>=b&&(N=function(){for(let e=0;e<x.length;e++){let t=x[e];if(!t.isChanged())return t}return null}(),N&&(i.info("Model: cache overflow; remove model from cache: "+N.modelId()),e.destroy(q(N.modelId())))),N=R[F[0]],N||(N={instances:{},instancesRef:{}},R[F[0]]=N),F[1]?(N.instancesRef[F[1]]=1,N.instances[F[1]]=D):(N.modelRef=1,N.model=D),i.info("Model: created model: "+t+" refCount: 1"),D},e.list=function(e,t,i){return he(null,i,e,t).map((e=>e.id))},e._resetTempIds=function(){V.clear()},e._getStats=function(){var e,t,i,n,s,r=[];for(e in R)if(M(R,e))for(s in(n=(t=R[e]).model)&&(i={name:n.name,instance:null,refCount:t.modelRef,cachePos:x.indexOf(n),subscribers:n._listeners.length,progressViews:n._listeners.map((function(e){return e.progressView||null}))},r.push(i)),t.instances)M(t.instances,s)&&(i={name:(n=t.instances[s]).name,instance:n.instance,refCount:t.instancesRef[s],cachePos:x.indexOf(n),subscribers:n._listeners.length,progressViews:n._listeners.map((function(e){return e.progressView||null}))},r.push(i));return r},e.anyChanges=function(e,t,i){return he("change",i,e,t).length>0},e.anyErrors=function(e,t,i){return he("error",i,e,t).length>0},e.addChangesToSaveRequest=function(e,t,i){let n=[],s=he("change",i,!1,t);if(s.length<=0)return null;for(let t=0;t<s.length;t++){let i=s[t].model.addChangesToSaveRequest(e);i&&n.push(i)}return function(e){for(let t=0;t<n.length;t++)n[t](e)}},e.save=function(e,i,n,s,r){let l,d,a,o;if(e=e||{},i=i||{},a=he("change",s,!1,n),l=apex.model.addChangesToSaveRequest(e,n,s),l){if(n&&void 0===i.loadingIndicator&&void 0===i.loadingIndicatorPosition){o=[];for(let e=1;e<a.length;e++)o.push(a[e].model);i.loadingIndicator=$(a[0].model,o)}return d=(r||t.plugin)(e,i),l(d),d}return null},e.multipleFetch=function(e,i,n,s){let r,l=[];if(e=e||{},i=i||{},n.forEach((t=>{let i,n=he(null,!1,!1,t);n.length>0&&(i=n[0].model._addToFetchRequest(e,0),i&&l.push(i))})),l.length>0){r=(s||t.plugin)(e,i);for(let e=0;e<l.length;e++)l[e](r);return r}return null},e.get=function(e){const t=q(e),n=R[t[0]];let s,r;return n&&(t[1]?(s=n.instances[t[1]],s&&(r=n.instancesRef[t[1]]+=1)):(s=n.model,s&&(r=n.modelRef+=1)),s&&(ce(s),i.info("Model: get model: "+e+" refCount: "+r))),s},e.renameInstance=function(e,t){const n=q(e),s=R[n[0]];if(s&&n[1]){let e=s.instances[n[1]];e.instance=t,delete s.instances[n[1]],s.instances[t]=e,i.info("Model: rename model "+n[0]+" instance: "+n[1]+" to "+t),j(e,"instanceRename",{oldInstance:n[1],newInstance:t})}},e.release=function(t){const n=q(t);let s,r=R[n[0]];r&&(n[1]?(s=r.instancesRef[n[1]]-=1,r=r.instances[n[1]]):(s=r.modelRef-=1,r=r.model),i.info("Model: release model: "+t+" refCount: "+s),s<=0&&(r._options.parentModel&&oe(r._options.parentModel)?(i.info("Model: save in cache model: "+t),function(e){let t=x.indexOf(e);t>=0&&x.splice(t,1),x.push(e)}(r)):r.isChanged()||e.destroy(t)))},e.destroy=function(t){const n=q(t);let s,r=R[n[0]];function l(n){if(n){if(ce(n),n.parentModelViewId){let t=n._options.parentModel,i=e.get(t);i&&(i.unSubscribe(n.parentModelViewId),n.parentModelViewId=null,e.release(t))}n._externalItems$&&n._externalItems$.off("change",n._externalItemsHandler),j(n,I,{}),n._data=null,n._index=null,n._selection=null,n._destroyed=!0,i.info("Model: destroy model: "+t)}}if(r){if(n[1])l(r.instances[n[1]]),delete r.instancesRef[n[1]],delete r.instances[n[1]];else if(l(r.model),delete r.model,delete r.modelRef,"string"==typeof t&&!n[1])for(s in r.instances)M(r.instances,s)&&(l(r.instances[s]),delete r.instancesRef[s],delete r.instances[s]);0!==Object.keys(r.instances).length||r.model||delete R[n[0]]}},e.getMaxCachedModels=function(){return b},e.setMaxCachedModels=function(e){b=parseInt(e,10)||10};const ue=new Map,fe=apex.WebComponent,ge={modelId:{type:fe.dataTypes.string},recordId:{type:fe.dataTypes.string,default:""},explicitStore:{type:fe.dataTypes.boolean,default:!1},syncWith:{type:fe.dataTypes.string,default:""}};fe._addHyphenCaseAttrNames(ge);const _e=fe._configObservedAttributes(ge),pe=class extends fe{#e=null;#t=null;#i=-1;#n=!1;#s=!1;#r=[];#l=null;#d=null;#a=null;#o=!1;#h=null;#c={modelId:null,recordId:null,explicitStore:null,syncWith:null};constructor(){super(),this._configPrivateState(this.#c);let e=this;this.#h=apex.actions.createContext("modelCursor",this),this.#h.add([{name:"cursor-next",action:function(){e.nextRecord()}},{name:"cursor-previous",action:function(){e.previousRecord()}}])}getModel(){return this.#e}getCurrentRecord(){return this.#t}firstRecord(){let e;if(this.#n){if(e=this.#e.getRecord(),e)return this.recordId=this.#e.getRecordId(e),!0}else if(this.#s);else if(e=this.#e.recordAt(0),e)return this.recordId=this.#e.getRecordId(e),this.#i=0,!0;return!1}nextRecord(){if(this.#n)return!1;let e,t=this.#i;if(this.#s);else if(t<0&&this.#t&&(this.#i=t=this.#e.indexOf(this.#t)),t>=0&&(t+=1,e=this.#e.recordAt(t),e))return this.recordId=this.#e.getRecordId(e),this.#i=t,!0;return!1}previousRecord(){if(this.#n)return!1;let e,t=this.#i;if(this.#s);else if(t<0&&this.#t&&(this.#i=t=this.#e.indexOf(this.#t)),t>=0){if(t-=1,t<0)return!1;if(e=this.#e.recordAt(t),e)return this.recordId=this.#e.getRecordId(e),this.#i=t,!0}return!1}lastRecord(){let e,t=0;if(this.#n){if(e=this.#e.getRecord(),e)return this.recordId=this.#e.getRecordId(e),!0}else if(this.#s);else{let i=this.#e.getTotalRecords(!0);if(i>0&&(t=i-1),e=this.#e.recordAt(t),e)return this.recordId=this.#e.getRecordId(e),this.#i=t,!0}return!1}store(){l(this).trigger("apexbindstore")}subscribe(e,t,i){this.#r.push({field:t,recordId:e,notify:i})}unsubscribe(e,t,i){let n=this.#r.findIndex((n=>n.notify===i&&n.recordId===e&&n.field===t));return n>=0&&this.#r.splice(n,1),0===this.#r.length}attributeChangedCallback(e,t,i){if(super.attributeChangedCallback(e,t,i),"model-id"===e){let e=this.#c.modelId;if(e.startsWith("[")&&e.endsWith("]"))try{e=JSON.parse(e),S(e)&&2===e.length||(e=null)}catch(t){e=null}this.#u(e)}else if("record-id"===e)t!==i&&this.#f(this.#c.recordId);else if("sync-with"===e&&t!==i){let e=apex.region(i),t=this;this.#a&&this.#a.off("interactivegridselectionchange.ig"),e&&"InteractiveGrid"===e.type&&(this.#a=e,e.on("interactivegridselectionchange.ig",n.debounce(((e,i)=>{const n=i.selectedRecords[0];n&&(t.#o=!0,t.recordId=i.model.getRecordId(n))}),100)))}}#u(t){let s=!0,r=!1;const l=(e,t)=>{if(e===c)0===this.#e._data.length&&(this.#t=null);else if(e===I)this.modelId="";else if(e===u){let e=this.#i;this.#f(this.#c.recordId),e>0&&null!==this.#t&&(this.#i=this.#e.indexOf(this.#t))}else if(e===g||e===f)for(let e=0;e<t.recordIds.length;e++){let i=t.recordIds[e];i===this.#c.recordId&&(this.#t=t.records[e]),this.#g(i,null)}else"move"===e||e===p||t.recordIds||"set"!==e&&"metaChange"!==e||this.#g(t.recordId,t.field)};this.#e&&(this.#e.unSubscribe(this.#l),s=S(this.#d)&&S(t)?!n.arrayEqual(this.#d,t):this.#d!==t,s&&(e.release(this.#d),this.#e=null,this.#t=null,r=!0));let d=this.recordId;if(t){s&&(this.#e=e.get(t),this.#e?this.#d=t:(this.#d=null,i.error("Model not found: ",this.#c.modelId)));let n=this.#e,d=n.getOption("shape");if(this.#n=d===o,this.#s=d===a,this.#l=n.subscribe({onChange:l}),r&&this.#c.recordId){let e=this.#n?n.getRecord():n.recordAt(0);e?(this.recordId=n.getRecordId(e),this.#i=0):this.recordId=""}else if(this.#n){let e="";n.getOption("identityField")&&(e=n.getRecordId(n.getRecord())),this.recordId=e}}else r&&this.#c.recordId&&(this.recordId="");this.#c.recordId===d&&this.#f(this.#c.recordId)}#g(e,t){const i=this.#r,n=this.#n;for(let s=0;s<i.length;s++){let r=i[s],l=r.recordId;l||n||(l=this.#c.recordId),!n&&e&&l!==e||t&&r.field!==t||r.notify()}}#f(e){(e||this.#n)&&this.#e?this.#t=this.#e.getRecord(e):this.#t=null,this.#i=-1,this.#g(null,null),this.#a&&(this.#o||this.#a.call("setSelectedRecords",[this.#t],!1,!1),this.#o=!1)}static get observedAttributes(){return _e}static get componentMetaData(){return ge}};apex.gPageContext$.on("apexreadyend",(()=>{customElements.define("a-model-cursor",pe)})),apex.binding.addDataRefType("model",{priority:10,subscribe:function(e,t){if(!e.field||!(e.cursor&&!e.modelId||!e.cursor&&e.modelId&&"string"==typeof e.modelId))return void i.error("Invalid model data reference: ",e);let s=e.cursor;if(!s){const t=e.modelId;if(s=ue.get(t),!s){let e=l(`<a-model-cursor model-id="${n.escapeHTMLAttr(t)}" style="display:none;"></a-model-cursor>`);e.appendTo("body"),s=e[0],ue.set(t,s)}}s.subscribe(e.recordId||null,e.field,t)},unsubscribe:function(e,t){let i=e.modelId,n=i?null:e.cursor;if(n||(n=ue.get(i)),n){n.unsubscribe(e.recordId||null,e.field,t)&&i&&(ue.delete(i),l(n).remove())}},_getCursorFromRef:function(e){let t=e.cursor;return t||(t=ue.get(e.modelId)),t||null},getValue:function(e){const t=this._getCursorFromRef(e),i=t?.getModel();if(!i)return"";let n,s="";return n=e.recordId?i.getRecord(e.recordId):t.getCurrentRecord(),n&&(s=i.getValue(n,e.field)),s},setValue:function(e,t,n,s,r){const l=this._getCursorFromRef(e),d=l?.getModel(),a=e.field;if(!d)return void i.warn("setValue no model",e);let o,h;if("record"!==d.getOption("shape")?(h=e.recordId||e.cursor.recordId,o=d.getRecord(h)):o=d.getRecord(),o){let e,i=d.getValue(o,a);if(null!==i&&"object"==typeof i&&M(i,"v")&&(t={v:t,d:n}),e=d.setValue(o,a,t),"DUP"===e);else{let e=d.getRecordId(o);s.valid?d.setValidity("valid",e,a):d.setValidity("error",e,a,r)}}},parse:function(e,t){let i,n=l(t).closest("[data-bind-model],[data-bind-cursor],a-model-cursor"),s=l(t).closest("[data-bind-record],.a-GV-row[data-id]"),r=s.attr("data-bind-record")||s.attr("data-id"),d=null;return n[0]?(i=n.attr("data-bind-cursor"),i&&(n=l("#"+i)),n.is("a-model-cursor")&&(i=n[0]),d={type:"model",field:e},i?d.cursor=i:d.modelId=n.attr("data-bind-model"),r&&(d.recordId=r),d):d}})}(apex.model,apex.server,apex.debug,apex.util,apex.item,apex.locale,apex.jQuery);
!function(e,t,i,s,o,a){"use strict";const l="a-GV",r="noDataMsg",n="moreDataMsg",h="altMessage",d=h+"-text",c=h+"-icon",g="footer",f="-hideDeleted",p="scrollFiller",u="controlBreak",m=".is-deleted",_="is-selected",R="."+_,P=".is-aggregate",v="aria-labelledby",S="aria-label",C="aria-selected",$="aria-current",I="aria-controls",k="aria-hidden",O="js-tabbable",w="."+O,T="js-rangeDisplay",y="."+T,b=":tabbable",A=":visible",D="data-start",M="data-end",x="data-id",F="data-rownum",E="data-state",L="data-page",H="class",z="disabled",N="role",j="region",B=".js-pg-prev,.js-pg-next,.js-pg-first,.js-pg-last",V="APEX.GV.",G="true",W="before",K="after",U="pageChange",q=e.hasOwnProperty,Y=Object.entries,X=e.applyTemplate,Q=Array.isArray,Z=e=>parseInt(e,10);let J=new Map;function ee(e){return s.getMessage(V+e)}function te(e,...t){return s.formatMessage(V+e,...t)}function ie(e,...t){return s.formatMessageNoEscape(V+e,...t)}function se(e,t){return Math.floor(e/t)*t}function oe(e,t,i,s,o){let a=Math.ceil((i+1-t)/s)*o;e.css("height",a)}function ae(t,i){const s=i.cssClassPrefix||l;return e.escapeHTMLAttr(s+"-"+t)}function le(e,t){return"."+ae(e,t)}function re(e,t,i,s){e.find(le(p,s)).each((function(){let e=a(this),s=Z(e.attr(D)),o=Z(e.attr(M));oe(e,s,o,t,i)}))}function ne(e){return"collapse"!==e.css("visibility")}function he(e,t){e.css("visibility",t?"":"collapse").toggleClass("is-hidden",!t)}function de(e){return e.getOption("hasTotalRecords")}a.widget("apex.tableModelViewBase",{widgetEventPrefix:"tableModelViewBase",options:{modelName:null,progressOptions:null,noDataMessage:"",entityTitleSingular:"",entityTitlePlural:"",cssClassPrefix:"",noDataIcon:"icon-irr-no-results",moreDataMessage:"",editable:!1,autoAddRecord:!1,hideDeletedRows:!1,hasSize:!1,footer:!0,fixedRowHeight:!0,showNullAs:"-",applyTemplateOptions:{},stickyTop:!1,stickyFooter:!1,hideEmptyFooter:!1,pagination:{scroll:!1,virtual:!1,loadMore:!1,showPageLinks:!1,maxLinks:5,showPageSelector:!1,showRange:!0,firstAndLastButtons:!1,hideSinglePage:!1},persistSelection:!1,highlights:{},highlighter:null,highlighterContext:null,rowsPerPage:null,selectionStatusMessageKey:"APEX.GV.SELECTION_COUNT",scrollParentOverride:null},firstPage:function(){let e;return!this.renderInProgress&&(this.options.pagination.scroll?(e=this.scrollParent$,e.scrollTop(this.scrollDelta)):this.pageOffset>0&&(this.pageOffset=0,this.refresh(!1)),!0)},previousPage:function(){let e,t;return!this.renderInProgress&&(this.options.pagination.scroll?(e=this.scrollParent$,t=e.scrollTop()-this.scrollDelta-this.viewportHeight,t<0&&(t=0),e.scrollTop(t+this.scrollDelta)):this.pageOffset>0&&(this.pageOffset-=this.pageSize,this.pageOffset<0&&(this.pageOffset=0),this.refresh(!1)),!0)},nextPage:function(){let e,t,i,s;return!this.renderInProgress&&(this.options.pagination.scroll?(e=this.scrollParent$,t=this._getDataContainer().first().height()-this.viewportHeight,i=e.scrollTop()-this.scrollDelta+this.viewportHeight,i>t&&(i=t),e.scrollTop(i+this.scrollDelta)):(s=this.model.getTotalRecords(),(s<0||this.pageOffset+this.pageCount<s)&&(this.pageOffset+=this.pageSize,this.refresh(!1))),!0)},lastPage:function(){let e,t,i,s;return!this.renderInProgress&&(this.options.pagination.scroll?(t=this.scrollParent$,i=this._getDataContainer().first().height()-this.viewportHeight,t.scrollTop(i+this.scrollDelta)):(s=this.model.getTotalRecords(),s>0&&this.pageOffset+this.pageCount<s&&(e=Math.ceil(s/this.pageSize),this.pageOffset=(e-1)*this.pageSize,this.refresh(!1))),!0)},loadMore:function(){return this.options.pagination.scroll&&!this._scrollHandler?this._addNextPage():this.nextPage()},getPageInfo:function(){let t=null,i=de(this.model),s=this.options.pagination,o=this.model.getTotalRecords(),l=this.model.getServerTotalRecords();if(!this.noData)if(t={rowHeight:this.avgRowHeight,recordsPerRow:this._getRecordsPerRow(),firstOffset:this.pageFirstOffset||null,lastOffset:this.pageLastOffset||null,pageSize:this.pageSize,pageOffset:this.pageOffset},i&&(t.total=l),s.scroll){let i,s=this.scrollParent$[0]===window,o="TBODY"===this._getDataContainer()[0].nodeName,l=this._getDataContainer().children().not(P);t.scrollOffset=this.scrollParent$.scrollTop(),i=e.binarySearch(l,t.scrollOffset,((e,i)=>{let l=a(i),r=s?l.offset().top:l.position().top;return s||o||l.offsetParent().closest(this.scrollParent$).length>0||(r+=t.scrollOffset),e-r})),t.viewOffset=Z(l.eq(i).attr(F))-1}else t.currentPage=Math.floor(this.pageOffset/this.pageSize),o>=0&&(t.totalPages=Math.ceil(o/this.pageSize));return t},gotoPage:function(e){let t,i=this.model.getTotalRecords();return!this.renderInProgress&&(i>0&&(t=Math.ceil(i/this.pageSize),e>=0&&e<t&&(this.pageOffset=e*this.pageSize,this.refresh(!1))),!0)},getActiveRecordId:function(){return this.activeRecordId},getActiveRecord:function(){return this.activeRecord},getModel:function(){return this.model},setActiveRecordValue:function(e){var t=this.columnItems[e];this.activeRecord&&t&&(this.ignoreItemChange=!0,this._setModelValue(null,t.item,this.activeRecord,e,!0),this.ignoreItemChange=!1)},lockActive:function(){this.activeRecord&&(this.activeLockCount+=1)},unlockActive:function(){this.activeRecord&&(this.activeLockCount-=1,this.activeLockCount<0&&(this.activeLockCount=0),0===this.activeLockCount&&(this.activeUnlockCallback&&(this.activeUnlockCallback(),this.activeUnlockCallback=null),this.finishEditingCallback&&(this.finishEditingCallback(),this.finishEditingCallback=null)))},finishEditing:function(){var e=this,t=a.Deferred();function i(){e._finishEditing?e._finishEditing(t):t.resolve()}return this.activeLockCount>0?this.finishEditingCallback=i:i(),t.promise()},addStateIcon:function(t,i,s){const o=e.htmlBuilder();this.stateIconMessages[t]=s,0===this._findStateIcon(t).length&&(o.markup("<span role='img'").attr(H,i).attr(E,t).attr(S,s||t).markup("></span>"),this.stateIcons$.append(o.toString()))},removeStateIcon:function(e){this._findStateIcon(e).remove(),delete this.stateIconMessages[e]},_create:function(){const e=this.options;e.hideDeletedRows&&this.element.addClass(ae(f,e)),this.noData=!0,this.pendingRefresh=null,this.renderInProgress=!1,this._refreshNeeded=!1,this.pageOffset=0,this.highWaterMark=0,this.pageCount=0,this.totalRenderedRecords=0,this.pageSize=10,this.onLastPage=!1,this.lastScrollLeft=null,this.lastScrollTop=null,this.scrollPageTimer=null,this.hasScrollFillers=!1,this._scrollHandler=null,this.stateIconMessages={},this.ignoreFieldChange=null,this.reinitCallbacks=null,this.activeRecord=null,this.activeRecordId=null,this.activeLockCount=0,this.activeUnlockCallback=null,this.columnItems=null,this.columnItemsContainer$=null,e.progressOptions||(e.progressOptions={fixed:!e.hasSize}),e.pagination.scroll&&!e.pagination.loadMore&&(e.rowsPerPage=null),e.rowsPerPage&&(this.pageSize=e.rowsPerPage),this._setOption("applyTemplateOptions",e.applyTemplateOptions)},_tableModelViewDestroy:function(){this.footer$&&(this.footer$.remove(),this.footer$=null),this.pageRange$=null,this.pageSelector$=null,this.status$=null,this.stateIcons$=null,this.element.removeClass(ae(f,this.options)),this._removeScrollHandler()},_refreshCheckIfVisible:function(){return null===this.element[0].offsetParent?(this.pendingRefresh=!0,!1):(this.pendingRefresh=!1,!0)},_initModel:function(i,s){const o=this.options,a=this;let l;let r=!0;if(this.model&&(this.model.unSubscribe(this.modelViewId),r=Q(this.modelName)&&Q(i)?!e.arrayEqual(this.modelName,i):this.modelName!==i,r&&(t.release(this.modelName),this.model=null,this.modelName=null)),this.modelChanged=r,i){if(r&&(this.modelName=i,this.model=t.get(i),!this.model))throw new Error("Model not found: "+i);this.modelViewId=this.model.subscribe({onChange:s||function(e,t){let i,s,r,n,h,d,c,g,f,p,u=!1;if(!a.pendingRefresh){if("refresh"===e)a.pageOffset=0,a.highWaterMark=0,a.pageCount=0,a.refresh();else if("refreshRecords"===e||"revert"===e){i=a._elementsFromRecordIds(t.recordIds);for(let e=0;e<i.length;e++)s=i[e],s&&(r=t.records[e],h=t.recordIds[e],n=t.newIds[h]||h,d=a.model.getRecordMetadata(n),a._replaceRecord(s,r,h,n,d));"refreshRecords"===e&&!o.pagination.scroll&&Object.keys(t.newIds).length>0&&(u=!0)}else if("move"===e){f=t.records,t.insertAfterId&&(i=a._elementsFromRecordIds([t.insertAfterId]),s=i.length>0?i[0]:null);for(let e=f.length-1;e>=0;e--)r=f[e],n=a.model.getRecordId(r),d=a.model.getRecordMetadata(n),i=a._elementsFromRecordIds([n]),i.length>0&&i[0]&&a._removeRecord(i[0]),c=a._insertRecord(s,r,n,d,s?K:W)}else if("insert"===e||"copy"===e)if("insert"===e?(p=!1,f=[t.record]):(p=!0,f=t.records),t.insertAfterId&&(i=a._elementsFromRecordIds([t.insertAfterId]),s=i.length>0?i[0]:null),a.noData)setTimeout((function(){a.refresh(),i=a._elementsFromRecordIds([a.model.getRecordId(f[0])]),i.length>0&&i[0]&&a._afterInsert(i,p)}),1);else{g=[];for(let e=f.length-1;e>=0;e--)r=f[e],n=a.model.getRecordId(r),d=a.model.getRecordMetadata(n),c=a._insertRecord(s,r,n,d,s?K:W),g.unshift(c);a._afterInsert(g,p)}else if("clearChanges"===e){if(l){i=a._elementsFromRecordIds(t.deletedIds);for(let e=0;e<i.length;e++)i[e]&&a._removeRecord(i[e]);t.deletedIds.length>0&&!o.pagination.scroll&&(u=!0)}i=a._elementsFromRecordIds(t.changedIds);for(let e=0;e<i.length;e++)s=i[e],s&&(n=t.changedIds[e],d=a.model.getRecordMetadata(n),r=a.model.getRecord(n),a._updateRecordState(s,n,r,d))}else if(t.recordIds){i=a._elementsFromRecordIds(t.recordIds);for(let h=0;h<i.length;h++)s=i[h],s&&(n=t.recordIds[h],d=a.model.getRecordMetadata(n),r=t.records[h],"delete"===e?(!o.hideDeletedRows&&l&&null!==d||a._removeFocus(s),l&&null!==d?a._updateRecordState(s,n,r,d):a._removeRecord(s)):a._updateRecordState(s,n,r,d));"delete"===e&&(0===a.model.getTotalRecords()?u=!0:l||o.pagination.scroll?o.hideDeletedRows&&(a.element.find(m).removeClass(_).removeAttr(C),a._updateStatus()):u=!0)}else if("set"===e||"metaChange"===e){if(null===a.ignoreFieldChange||a.ignoreFieldChange!==t.field){let s=t.property;r=t.record,n=a.model.getRecordId(r),t.oldIdentity&&a._identityChanged(t.oldIdentity,n),d=a.model.getRecordMetadata(n),i=a._elementsFromRecordIds([n]),i.length>0&&i[0]&&("set"===e&&a._updateRecordField(i[0],r,t.field,d),a._updateRecordState(i[0],n,r,d,s))}}else"instanceRename"===e&&a.modelName[1]===t.oldInstance&&(a.modelName[1]=t.newInstance);u?a._refreshNeeded||(a._refreshNeeded=!0,queueMicrotask((()=>{a.refresh(),a._refreshNeeded=!1}))):"refresh"!==e&&a._updateTotalRecords()}},progressView:this.element,progressOptions:o.progressOptions}),l=this.model.getOption("onlyMarkForDelete"),this.options.pagination.scroll&&this.scrollParent$&&this.scrollParent$.scrollTop()>this.scrollDelta&&this.scrollParent$.scrollTop(this.scrollDelta),this.pageOffset=0,this.highWaterMark=0,this.pageCount=0}},_renderButton:function(e,t,i,s,o){e.markup(`<button class='${t}' type='button'`).attr(S,s).attr("title",s).optionalAttr("aria-expanded",null==o?null:o?G:"false").markup("><span aria-hidden='true' class='a-Icon ").attr(i).markup("'></span></button>")},_renderAltDataMessages:function(e,t){const i=this.options;function o(s,o,a,l,r,n){e.markup(`<div class='${s} ${ae(h,i)}' style='display:none;' `).optionalAttr(N,r).optionalAttr(S,n).markup(`><div class='${ae(c,i)}' `).optionalAttr(N,n?"img":null).optionalAttr(S,n).optionalAttr(k,n?null:G).markup(`><span class='a-Icon ${a}'></span></div>`).markup(`<div role='status'><span class='${ae(d,i)}'`).optionalAttr("id",t?t+o+"_msg":null).markup(`>${l}</span></div></div>`)}o(ae(r,i),"_no",i.noDataIcon,i.noDataMessage,"region",s.getMessage("APEX.IG.NO_DATA_FOUND")),o(ae(n,i),"_more","icon-warning",i.moreDataMessage)},_renderLoadMore:function(e){const t=this.options,i=t.pagination;i.scroll&&i.loadMore&&e.markup(`<div class="${ae("loadMore",t)}"><button type="button" class="a-Button js-load ${ae("loadMoreButton",t)}">`).content(ee("LOAD_MORE")).markup("</button></div>")},_renderFooter:function(e,t){const i=this.options;function s(){let s=i.entityTitlePlural?ie("PAGE_RANGE_ENTITY",i.entityTitlePlural):ee("PAGE_RANGE");e.markup("<span ").attr(H,T).optionalAttr("id",t?t+"_pageRange":null).attr("title",s).markup(`><span class="${ae("pageRange",i)} "></span></span>`)}if(i.footer){if(e.markup(`<div class="${ae(g,i)}" style="display:none;" `).attr(N,j).attr(S,ee("FOOTER_LANDMARK")).markup(`><div class="${ae("stateIcons",i)}" `).attr(N,j).attr(S,ee("STATE_ICONS_LANDMARK")).markup("></div><div ").attr(N,j).attr(S,ee("STATUS_LANDMARK")).markup("><div ").optionalAttr("id",t?t+"_status":null).attr(H,ae("status",i)).attr(N,"status").markup(`></div></div><div class="${ae("pagination",i)}" `).optionalAttr(N,i.pagination?j:null).optionalAttr(S,i.pagination?ee("PAGINATION_LANDMARK"):null).markup(">"),i.pagination){const t=[ae("pageButton",i),ae("pageButton--nav",i),"a-Button"],o=de(this.model);let a=!1;i.pagination.scroll||(o&&i.pagination.firstAndLastButtons&&this._renderButton(e,t.join(" ")+" js-pg-first","icon-first",ee("FIRST_PAGE")),this._renderButton(e,t.join(" ")+" js-pg-prev","icon-prev",ee("PREV_PAGE"))),o&&(i.pagination.showPageLinks||i.pagination.showPageSelector)?e.markup(`<span class="${ae("pageSelector",i)}"></span>`):i.pagination.showRange&&(s(),a=!0),i.pagination.scroll||(this._renderButton(e,t.join(" ")+" js-pg-next","icon-next",ee("NEXT_PAGE")),o&&i.pagination.firstAndLastButtons&&this._renderButton(e,t.join(" ")+" js-pg-last","icon-last",ee("LAST_PAGE"))),!a&&i.pagination.showRange&&s()}e.markup("</div></div>")}},_refreshPagination:function(e){let t=this.options,i=t.pagination;this.hasScrollFillers=i.scroll&&i.virtual&&!i.loadMore,this.lastScrollTop=null,this.lastScrollLeft=null,e.length&&(t.hasSize||(e=t.scrollParentOverride?a(t.scrollParentOverride):a(window)),this.lastScrollLeft=e.scrollLeft(),this.lastScrollTop=e.scrollTop())},_paginationHasFocus:function(){const e=this.options,t=a(document.activeElement);if(t.closest(le(g,e)).length>0){if(t.parent().hasClass(ae("pageSelector-item",e)))return t.parent().attr(L);{const e=/js-pg-\S+/.exec(t.attr(H));if(e)return"."+e[0]}}return!1},_restorePaginationFocus:function(e){if(e){let t,i=e;i>=0&&(i=`[${L}='${e}'] button`),t=this.footer$.find(i),t[0]&&t[0].disabled&&(t=this.footer$.find(":focusable").eq(0)),t.trigger("focus")}},_initPagination:function(e,t){const i=this.options,s=this.element,o=s.hasClass("u-RTL")?"right":"left",l=this.footer$=s.find(le(g,i));if(this.pageKey=null,this.status$=l.find(le("status",i)),this.stateIcons$=l.find(le("stateIcons",i)),this.pageRange$=l.find(le("pageRange",i)),this.pageSelector$=l.find(le("pageSelector",i)),this.noData$=s.find(le(r,i)),this.moreData$=s.find(le(n,i)),a.ui.tooltip){let e=this.stateIconMessages;this.stateIcons$.tooltip({content:function(){let t=a(this).attr(E);return e[t]},items:`[${E}]`,show:apex.tooltipManager.defaultShowOption(),tooltipClass:ae("tooltip",i),position:{my:o+" bottom",at:o+" top-10",collision:"flipfit"}})}if(this._updateScrollHandler(t),i.pagination.scroll&&(this.pageOffset=0,this.highWaterMark=0,this.pageCount=0,this.totalRenderedRecords=0),!i.hasSize&&a.apex.stickyWidget){if(i.stickyTop){let t={stickToEnd:!0,toggleWidth:!0,bottom:()=>s.offset().top+s.outerHeight()-this._footerHeight()};"function"==typeof i.stickyTop&&(t.top=i.stickyTop),e.css("overflow","hidden").stickyWidget(t)}i.footer&&i.stickyFooter&&l.stickyWidget({isFooter:!0,toggleWidth:!0,stickToEnd:!0,top:()=>s.offset().top+this._getHeaderHeight()})}i.pagination.showPageLinks?this.pageSelector$.on("click",(e=>{let t=a(e.target).parent();t.length&&this.gotoPage(Z(t.attr(L))),e.preventDefault()})):i.pagination.showPageSelector&&this.pageSelector$.on("change",(e=>{this.gotoPage(Z(a(e.target).val()))})),l.find(".js-pg-first").on("click",(()=>{this.firstPage()})),l.find(".js-pg-prev").on("click",(()=>{this.previousPage()})),l.find(".js-pg-next").on("click",(()=>{this.nextPage()})),l.find(".js-pg-last").on("click",(()=>{this.lastPage()})),s.find(".js-load").on("click",(()=>{const e=this.scrollParent$.scrollTop();this.loadMore(),this.focus(),this.scrollParent$.scrollTop(e)}))},_footerHeight:function(){return this.footer$.outerHeight()||0},_addNextPage:function(){if(this.renderInProgress)return!1;let e=this.model.getTotalRecords();return(e<0||this.pageOffset+this.pageCount<e)&&(this.pageOffset+=this.pageCount,this._addPageOfRecords()),!0},_addPageOfRecords:function(e,t){const i=this,s=this.options,o=this._hasControlBreaks(),l=de(this.model),r=le(u,s),n=ae(p,s),d=le(p,s);let c,g,f,m,_,R,v=this._getDataRenderContext();function S(e,t,i,s,o){return e>t||(i.attr(D,e),i.attr(M,t),oe(i,e,t,s,o),!1)}function C(e,t,i,l){let h=l||0,d=i-t;return o&&(h=t+h,d=i,t=0,i+=e.filter(r).length),e.slice(t,i).filter(((e,t)=>{let i=a(t);return i.hasClass(ae(u,s))&&(e<h&&(h+=1),d+=1),i.hasClass(n)&&(d=e),e>=h&&e<d}))}function $(e,t,i){let o=t,a=m.find(`[${F}="${t+1}"]`);return(e&&!ne(e)||!a.is(A))&&(o=Z(a[i?"nextAll":"prevAll"](` ${le("row",s)} [${F}]:visible`).first().attr(F))||0),o}if(!this.renderInProgress){if(_=i.noData$.parent().children().not(le(h,s)),!this.noData&&!this.moreData$.is(A)||s.bodyTemplate||(this.noData$.hide(),this.moreData$.hide(),_.show(),this.resize()),m=i._getDataContainer(),0!==this.pageOffset&&s.pagination.scroll||(this.pageFirstOffset="",this.pageLastOffset=""),s.pagination.scroll||(this.totalRenderedRecords=0),this.controlBreakCollapsed=!!o&&null,o)if(0!==this.pageOffset&&s.pagination.scroll){let e=this.model.getOption("metaField");if(e){let t=this.pageOffset-1;for(;t>0;){let i,s=this.model.recordAt(t);if(s&&(i=this.model.getValue(s,e),!i.agg)){R=!0===i.endControlBreak;break}t-=1}}}else R=!0;if(c=0,g=this.pageSize,s.pagination.scroll){if(i.hasScrollFillers){m.find(d).each((function(){let e=a(this),t=Z(e.attr(D)),s=Z(e.attr(M));if(i.pageOffset>=t&&i.pageOffset<s)return g=Math.min(g,s+1-i.pageOffset),!1}))}}else this.pageOffset=se(this.pageOffset,g);f=this.pageOffset,this.renderInProgress=!0,this.model.forEachInPage(this.pageOffset,g,(function(h,p,u,I){if(t&&0===c&&this._getDataContainer().empty(),h){let e,t,i=u?this.model.getRecordMetadata(u):{},s=i.serverOffset;o&&!i.agg&&(e=!0,R&&(R=!1,t=this._controlBreakLabel(h),this._renderBreakRecord(v,e,t,s)),i.endControlBreak&&(R=!0)),this._renderRecord(v,h,p,u,i),void 0!==s&&(s+=1,""===this.pageFirstOffset&&(this.pageFirstOffset=s),s>this.pageLastOffset&&(this.pageLastOffset=s)),c+=1}c!==g&&h&&!I||function(t){let o,h,g,p,u,R,I,k=i.avgRowHeight;if(i.pageCount=c,i.totalRenderedRecords+=c,i.pageOffset+c>i.highWaterMark&&(i.highWaterMark=i.pageOffset+c),0===i.pageOffset&&0===c)i.noData=!0,_.hide(),i.moreData$.hide(),i.noData$.show(),i._trigger(U,null,{offset:0,count:0}),s.autoAddRecord&&i.model.allowAdd()&&!t&&i._autoAddRecord();else{if(0===c)return i.renderInProgress=!1,void(s.pagination.scroll||(i.pageOffset-=i.pageSize,i.pageOffset<0&&(i.pageOffset=0),i._addPageOfRecords()));if(i.noData=!1,i.noData$.hide(),i.model.getDataOverflow()&&s.moreDataMessage?(i.moreData$.show(),_.hide()):(i.moreData$.hide(),_.show()),i.hasScrollFillers){o=m.find(d),g=i.model.getTotalRecords(!0)-1,u=g,0===o.length&&l?(h=i._getDataRenderContext(),i._renderFillerRecord(h,n),o=i._insertFiller(h,null),o.attr(D,0),o.attr(M,g),o=o.last()):0===o.last().next().length&&(u=Z(o.last().attr(M))),g!==u&&o.last().attr(M,g),p=i._getRecordsPerRow();let e=-1,t=!1;if(o.each((function(s){let o,l=!1,r=a(this),d=Z(r.last().attr(D)),g=Z(r.last().attr(M));if(f===d?(l=S(f+c,g,r,p,k),i._insertData(v,f,c,r,W),e=s,t=!0):f+c<g?(S(f+c,g,r,p,k),h=i._getDataRenderContext(),i._renderFillerRecord(h,n),o=i._insertFiller(h,r),S(d,f-1,o,p,k),i._insertData(v,f,c,r,W),e=s+1,t=!0):f<=g&&f+c>g&&(l=S(d,f-1,r,p,k),i._insertData(v,f,c,r,K),e=s+1,t=!0),t)return l&&(e===s&&(e=s+1),r.remove()),!1})),t||(i._insertData(v,f,c),e=o.length),i.totalRenderedRecords>8*i.pageSize){let t,a,l,c,f,u,_,v=0,O=null,w=0,T=0,y=!1;if(s.fixedRowHeight||(R=m.find(`[${F}="${i.pageOffset+1}"]`),R[0]&&(I=R.offset().top)),o=m.find(d),_=o.length-1,T>=e)T=-1,f=2*i.pageSize;else{for(O=o.eq(T);O.next().is(d);)O=O.next();f=Z(O.attr(M))}if(f>0&&(v=Math.abs(i.pageOffset-$(O,f+1,!0))),v>=3*i.pageSize)T>=0?(c=C(O.nextAll(),0,i.pageSize),w=c.not(r).length,l=c.first().is(A)&&c.last().is(A),u=c.last().next().filter(d),u.length&&l===ne(u)?(t=Z(O.attr(D)),a=Z(u.attr(M)),S(t,a,u,p,k),O.remove()):l===ne(O)?(t=Z(O.attr(D)),a=Z(O.attr(M))+w,S(t,a,O,p,k)):(t=Z(O.attr(M))+1,y=!0)):(t=f,a=t+i.pageSize,c=C(m.children(),t,a),w=c.not(r).length,l=c.first().is(A)&&c.last().is(A),y=!0),y&&(h=i._getDataRenderContext(),i._renderFillerRecord(h,n),O=i._insertFiller(h,c.eq(0)),S(t,t+w-1,O,p,k),he(O,l));else{let s;if(v=0,_<e)_=-1,f=-1,s=m.children().not(P).last(),s.attr(x)&&(f=i.model.indexOf(i.model.getRecord(s.attr(x))),f=se(f,i.pageSize)-i.pageSize);else{for(O=o.eq(_);O.prev().is(d);)O=O.prev();f=Z(O.attr(D))}f>0&&(v=Math.abs(i.pageOffset+i.pageSize-$(O,f-1,!1))),v>=3*i.pageSize&&(_>=0?(c=C(O.prevAll(),0,i.pageSize),w=c.not(r).length,l=c.first().is(A)&&c.last().is(A),u=c.prev(d),u.length&&l===ne(u)?(t=Z(u.attr(D)),a=Z(O.attr(M)),S(t,a,u,p,k),O.remove()):l===ne(O)?(t=Z(O.attr(D))-w,a=Z(O.attr(M)),S(t,a,O,p,k)):(t=Z(O.attr(D))-w,a=t+w-1,y=!0)):(t=g-f,a=t+i.pageSize,c=C(s.prevAll(),0,a,t),w=c.not(r).length,w>0&&(l=c.first().is(A)&&c.last().is(A),y=!0,a=f-1,t=f-w)),y&&(h=i._getDataRenderContext(),i._renderFillerRecord(h,n),O=i._insertFiller(h,c.eq(0)),S(t,a,O,p,k),he(O,l)))}w>0&&(c.remove(),i.totalRenderedRecords-=w)}if(!s.fixedRowHeight){let e=0;i._updateAvgRowHeight(),re(i._getDataContainer(),p,i.avgRowHeight,s),R&&R[0]&&(e=R.offset().top-I),0!==e&&i.scrollParent$.scrollTop(i.scrollParent$.scrollTop()+e)}}else i._insertData(v,f,c)}if(i._updateTotalRecords(),i.renderInProgress=!1,!i.noData&&s.pagination.scroll&&(i.controlBreakCollapsed||!l&&m.height()<i.scrollParent$.height())){let t=i.model.getTotalRecords(),s=i.hasScrollFillers?i.pageOffset+i.pageCount:i.highWaterMark;if(t<0||s<t){let t=!0;if(i.pageOffset=s,i.hasScrollFillers&&(t=!1,o=m.find(d),o.each((function(){if(i.pageOffset===Z(a(this).attr(D)))return t=!0,!1}))),t)return void i._addPageOfRecords(e)}}e&&e()}(I)}),this)}},_initPageSize:function(){let t,i,s,o,a=this.options,l=this._getRecordsPerRow();this.hasScrollFillers&&(this.recPerRow!==l&&re(this._getDataContainer(),l,this.avgRowHeight,a),this._scrollPage()),this.recPerRow=l,this._updateAvgRowHeight(),t=this.avgRowHeight,a.hasSize?i=this.scrollParent$[0].offsetHeight:(i=this.scrollParent$.height(),this.footer$.hasClass("js-stickyWidget-toggle")&&(i-=this._footerHeight()),o=this._getStickyTop(),o>0&&(i-=o+this._getHeaderHeight())),i-=e.getScrollbarSize().height,s=Math.floor(i/t),s<1&&(s=1),this.viewportHeight=s*t,a.rowsPerPage||(a.fixedRowHeight||a.pagination.scroll?(s*=l,a.pagination.scroll?(this.pageSize=Math.round(Math.max(20,1.5*s)),this.pageSize=Math.ceil(this.pageSize/l)*l):this.pageSize=s):this.pageSize=20)},_updateStatus:function(){var e,t=this._selectedCount(),i="";this.options.hideDeletedRows&&(e=this._deletedCount()),t>0&&(i+=s.format(this._selectedStatusMessage(),t)),e>0&&(i&&(i+=", "),i+=te("DELETED_COUNT",e)+" "),this.status$.text(i)},_setModelValue:function(e,t,i,s,o){var a,l,r,n,h;e&&e.removeClass("is-active"),a=t.getValue(),o||(this.ignoreFieldChange=s),h=this.model.getRecordId(i),null!==(l=this.model.getValue(i,s))&&"object"==typeof l&&q(l,"v")&&(a={v:a,d:t.displayValueFor(a)}),"DUP"===this.model.setValue(i,s,a)?(this._setColumnItemValue(t,i,s),apex.message.alert(ee("DUP_REC_ID"))):(r=t.getValidity(),n=this.model.getRecordId(i),r.valid?this.model.setValidity("valid",n,s):this.model.setValidity("error",n,s,t.getValidationMessage()),n!==h&&this._identityChanged(h,n)),o||(this.ignoreFieldChange=null)},_initColumnItems:function(e){const t=this.options;let s=!0;this.columnItems={},this.columnItemsContainer$=null,this.asyncColumnItems=[];for(let i=0;i<e.length;i++){let a,l=e[i],r=l.elementId,n=null;r&&(J.has(r)?(n=this.columnItems[l.property]=J.get(r),a=n.item):(a=o(r),a.node&&(s=!1,n=this.columnItems[l.property]={element$:a.element.closest(le("columnItem",t)),item:a},J.set(r,n),a.whenReady&&this.asyncColumnItems.push(a.whenReady()))),n&&!this.columnItemsContainer$&&(this.columnItemsContainer$=n.element$.parent()))}this.columnItemsContainer$?s||this.columnItemsContainer$.find(b).addClass(O).attr("tabindex",-1):this.editable&&i.error(`An editable ${this.widgetName} must have at least one column with a column item.`)},_waitForColumnItems:function(){return a.when(...this.asyncColumnItems)},_activateColumnItem:function(e,t){var i=e.element$;i.find(w).attr("tabindex",0).removeClass(O),t&&(a("label[id='"+t+"']").length||i.find(b).first().attr(v,t))},_deactivateColumnItem:function(e){var t=e.element$,i=t.find(b);i.first().removeAttr(v),this.columnItemsContainer$.append(t),i.addClass(O).attr("tabindex",-1)},_renderFieldDataValue:function(t,i,s,o,a){var l,r,n,h=null,d=this.options;(a&&a.url||i.linkTargetColumn)&&!o.agg&&(h=i.linkTargetColumn?this.model.getValue(s,i.linkTargetColumn)||null:a.url),l=this.model.getValue(s,i.property),(o.agg||o.inserted&&i.readonly)&&this.model.isIdentityField(i.property)&&(l=""),(i.linkText||i.linkAttributes||i.cellTemplate)&&((r=this.atOptions).model=this.model,r.record=s),h&&(t.markup("<a").attr("href",h),i.linkAttributes&&t.markup(X(i.linkAttributes,r)),t.markup(" tabindex='-1'>")),h&&i.linkText?t.markup(X(i.linkText,r)):i.cellTemplate?o.agg?(l=null==l?"":l,t.content(""+l)):(l=X(i.cellTemplate,r),d.highlighter&&(l=d.highlighter(d.highlighterContext,l,i)),t.markup(l)):null!==l&&""!==l||!(d.showNullAs||o.agg||h)?(null===l&&(l=""),"object"==typeof l&&q(l,"d")?l=l.d:(n=this.columnItems[i.property])&&(l=n.item.displayValueFor(l,{readonly:a&&!!a.ck||i.readonly||o.deleted||!1,disabled:a&&a.disabled||!1})),!1!==i.escape&&(l=e.escapeHTML(""+l)),!0===i.sanitize&&(l=e.sanitizeHtml(""+l)),d.highlighter&&(l=d.highlighter(d.highlighterContext,l,i)),t.markup(l)):(l=o.agg||o.inserted||a&&(a.changed||a.error||a.warning)?"":h||d.showNullAs,t.content(l)),h&&t.markup("</a>")},_beginSetColumnItems:function(){this.reinitCallbacks=[]},_setColumnItemValue:function(e,t,i,s){var o,a=null,l=this.model.getValue(t,i);null!==l&&"object"==typeof l&&q(l,"d")&&(a=l.d,l=l.v),this.reinitCallbacks?(o=e.reinit(l,a))&&this.reinitCallbacks.push(o):e.setValue(l,a),s&&(s.fields&&s.fields[i]&&s.fields[i].disabled?e.disable():e.enable())},_endSetColumnItems:function(){var e,t=this.reinitCallbacks;if(t)for(e=0;e<t.length;e++)t[e]();this.reinitCallbacks=null},_autoAddRecord:function(e){var t=this.model.insertNewRecord(null,e);this.model.getRecordMetadata(t).autoInserted=!0},_triggerBeginEditing:function(e,t){this.element.trigger("apexbeginrecordedit",[{model:this.model,record:e,recordId:t}])},_triggerEndEditing:function(e,t){this.element.trigger("apexendrecordedit",[{model:this.model,record:e,recordId:t}])},_updateHighlights:function(){let e=this.options,t=[],i="";for(const[i,s]of Y(e.highlights))s.id=i,t.push(s);t.sort(((e,t)=>t.seq-e.seq));for(let e=0;e<t.length;e++){let s=t[e];s.cssClass||(s.cssClass=(s.row?"hlr_":"hlc_")+s.id),(s.color||s.background)&&(s.row?i+="."+s.cssClass+" td":i+="td."+s.cssClass,i+=" { ",s.color&&(i+="color: "+s.color+" !important; "),s.background&&(i+="background-color: "+s.background+" !important; "),i+="}\n")}!this.gridStyles$&&i&&(this.gridStyles$=a("<style></style>"),a("head").append(this.gridStyles$)),this.gridStyles$&&(this.gridStyles$=this.gridStyles$.text(i))},_findStateIcon:function(e){return this.stateIcons$.find(`[${E}='${e}']`)},_setOption:function(e,t){const s=this.options;this._super(e,t),"noDataMessage"===e?this.element.find(le(h,s)+" > div > "+le(d,s)).text(t):"noDataIcon"===e?this.element.find(le(h,s)+" > "+le(c,s)+" span").attr(H,"a-Icon "+t):"rowsPerPage"===e?(s.pagination.scroll&&!s.pagination.loadMore&&(i.warn("Ignoring rowsPerPage when scroll pagination."),s.rowsPerPage=null),s.rowsPerPage&&(this.pageSize=s.rowsPerPage)):"hideDeletedRows"===e?(this.element.toggleClass(ae(f,s),t),!0===t&&this.element.find(m).removeClass(_).removeAttr(C),this._updateStatus()):"scrollParentOverride"===e?s.hasSize?i.warn("Ignoring scrollParentOverride when hasSize is true."):this._updateScrollHandler():"applyTemplateOptions"===e&&(this.atOptions=a.extend(!0,{},s.applyTemplateOptions||{},{extraSubstitutions:{}}))},_updateScrollHandler:function(e){let t=this.options,i=this.scrollParent$,s=t.scrollParentOverride;t.hasSize?(this.scrollParent$=e,this.scrollDelta=0):(this.scrollParent$=a(s||window),this.scrollDelta=this.element.offset().top-this._getStickyTop()),this.totalRenderedRecords=0,t.pagination.scroll&&!t.pagination.loadMore&&(i&&this._scrollHandler?i.off("scroll",this._scrollHandler):this._scrollHandler=()=>{this.element[0].clientWidth>0&&this._scrollPage()},this.scrollParent$.on("scroll",this._scrollHandler))},_removeScrollHandler:function(){this._scrollHandler&&(this.scrollParent$.off("scroll",this._scrollHandler),this._scrollHandler=null)},_scrollPage:function(){const e=this,t=this.scrollParent$.scrollTop(),i=e.options;t!==this.lastScrollTop&&(this.lastScrollTop=t,this.scrollPageTimer||(this.scrollPageTimer=setTimeout((function(){let t,s,o,l,r,n,h,d,c=null,g=!1,f=de(e.model),u=e.scrollParent$[0]===window,m=e.avgRowHeight;if(e.scrollPageTimer=null,e.renderInProgress)return e.lastScrollTop=null,void e._scrollPage();if(l=e.scrollParent$.height(),r=0-l/2,l*=2,n=r+l,t=e._getDataContainer(),s=e.scrollParent$.scrollTop(),e.hasScrollFillers&&(c=t.find(le(p,i)),!c.length&&f&&e._removeScrollHandler(),o=e.pageOffset,t[0]&&(d="TBODY"===t[0].nodeName),c.each((function(){var t,i,h=a(this),c=Z(this.style.height),f=Z(h.attr(D)),p=Z(h.attr(M));if(!(f>p))return i=u?h.offset().top:h.position().top,(u||d||h.offsetParent().closest(e.scrollParent$).length>0)&&(i-=s),t=i+c,i<=n&&t>=r?(e.pageOffset=c<2*l||i>r?f:se(t<n?p:f+Math.ceil((r+l/2-i)*e._getRecordsPerRow()/m),e.pageSize),e.pageOffset!==o&&e._addPageOfRecords(),g=!0,ne(h)||he(h,!0),!1):void 0}))),!(g||f&&e.hasScrollFillers)){let i=t.height();(u||t.offsetParent().closest(e.scrollParent$).length>0)&&(i+=u?t.offset().top:t.position().top),i-=s,i>0&&i<=1.5*l&&(h=e.model.getTotalRecords(),h<0||e.highWaterMark<h?(e.pageOffset=e.highWaterMark,e._addPageOfRecords()):(c&&0===c.length||!c&&h===e.totalRenderedRecords)&&e._removeScrollHandler())}}),300)))},_updateTotalRecords:function(){const e=this.options,t=this.footer$,i=this.pageSelector$,s=e.pagination,o=this.model.getTotalRecords(),l=this.model.getServerTotalRecords();let r,n,h,d,c,g,f,p=null,u=null;function m(t){return 1===t&&e.entityTitleSingular?ie("TOTAL_ENTITY_SINGULAR",e.entityTitleSingular):t>1&&e.entityTitlePlural?ie("TOTAL_ENTITY_PLURAL",l,e.entityTitlePlural):te("TOTAL_PAGES",l)}if(o>=0&&(p=Math.ceil(o/this.pageSize),u=Math.floor(this.pageOffset/this.pageSize)),null!==this.lastScrollLeft&&(this.scrollParent$.scrollLeft(this.lastScrollLeft),this.scrollParent$.scrollTop(this.lastScrollTop),this.lastScrollLeft=null,this.lastScrollTop=null),this.onLastPage=!1,0===this.pageCount&&0===this.pageOffset?(h="",this.onLastPage=!0,t.find(B).attr(z,!0),t.find(y).attr(k,G)):(t.find(B).attr(z,!1),t.find(y).removeAttr(k),this.element.find(".js-load").attr(z,!1),0===this.pageOffset&&t.find(".js-pg-prev,.js-pg-first").attr(z,!0),o>0&&u===p-1&&(this.onLastPage=!0,t.find(".js-pg-next,.js-pg-last").attr(z,!0),this.element.find(".js-load").attr(z,!0)),s.loadMore&&s.hideSinglePage&&this.element.find(".js-load").toggle(1!==p),g=de(this.model),h=s.scroll&&s.virtual&&!s.loadMore&&g?m(l):g?s.hideSinglePage&&1===p?m(l):te("PAGE_RANGE_XYZ",this.pageFirstOffset,this.pageLastOffset,l):te("PAGE_RANGE_XY",this.pageFirstOffset,this.pageLastOffset)),document.activeElement&&document.activeElement.disabled&&a(document.activeElement).hasClass("js-load")&&this.focus(),this.pageRange$&&this.pageRange$.text(h),p>0){if(s.showPageLinks){if(c=`${o}_${this.pageSize}_${u}`,this.pageKey!==c){f=`<li class="${ae("pageSelector-item",e)}">&hellip;</li>`,this.pageKey=c,d=`<ul class="${ae("pageSelector-list",e)}">`,r=u-Math.floor(s.maxLinks/2),r<0&&(r=0),n=r+s.maxLinks,n>=p&&(n=p,r=n-s.maxLinks,r<0&&(r=0)),r>0&&(d+=f);for(let t=r;t<n;t++)d+=`<li class="${ae("pageSelector-item",e)}" ${L}='${t}'><button class="${ae("pageButton",e)}" type='button'>${t+1}</button></li>`;n<p&&(d+=f),d+="</ul>",i.html(d)}i.find(R).removeClass(_).removeAttr($).attr(I),i.find(`[${L}='${u}']`).addClass(_).attr($,"page").attr(I,this.element[0].id)}else if(s.showPageSelector){if(c=`${o}_${this.pageSize}`,this.pageKey!==c){this.pageKey=c,d=`<select class="${ae("pageSelectlist",e)}" size='1' aria-label='${ee("PAGE_SELECTION")}' aria-controls='${this.element[0].id}'>`;for(let e=0;e<p;e++)d+=`<option value='${e}'>${te("SELECT_PAGE_N",e+1)}</option>`;d+="</select>",i.html(d)}i.children("select").val(u)}}else i.empty(),this.pageKey=null;s.hideSinglePage&&!s.scroll&&(t.find(B).add(i)[1===p?"hide":"show"](),t.find(y)[g?"show":"hide"]()),t[this.noData&&e.hideEmptyFooter?"hide":"show"]()},_updateAvgRowHeight:function(){let e,t=this.options;if(t.fixedRowHeight)e=this._getFixedRecordHeight();else{let i,s=this._getRecordsPerRow(),o=Math.ceil(this.totalRenderedRecords/s);o<=0?e=this.avgRowHeight||this._getFixedRecordHeight():(i=this._getDataContainer().height(),this._getDataContainer().find(le(p,t)).each((function(){i-=a(this).height()})),e=i/o)}e<=0&&(e=43),this.avgRowHeight=e},_getStickyTop:function(){let e=this.options.stickyTop;return"function"==typeof e?e():0},_getHeaderHeight:function(){return 0},_getRecordsPerRow:function(){return 1},_getDataRenderContext:function(){return e.htmlBuilder()},_selectedCount:function(){return 0},_selectedStatusMessage:function(){return s.getMessage(this.options.selectionStatusMessageKey)},_deletedCount:function(){return 0},_hasControlBreaks:function(){return!1},_elementsFromRecordIds:function(){return[]},_renderFillerRecord:function(){},_insertFiller:function(){return a()},_insertData:function(e,t,i){this._trigger(U,null,{offset:t,count:i})},_controlBreakLabel:function(){return{}},_renderBreakRecord:function(e,t,i){e.markup("<h3>").content(i.label).markup("</h3>")},_renderRecord:function(){},_removeRecord:function(){},_insertRecord:function(){return a()},_afterInsert:function(){},_identityChanged:function(){},_replaceRecord:function(){},_updateRecordField:function(){},_removeFocus:function(){},_updateRecordState:function(){}}),a.apex.tableModelViewBase.clearColumnItemCache=function(e){if(e)for(const[t,i]of J.entries())i.element$.parent()[0]===e&&J.delete(t);else J.clear()}}(apex.util,apex.model,apex.debug,apex.lang,apex.item,apex.jQuery);
!function(t,e,i,s,o,n){"use strict";const a="a-GV",l="scrollFiller",r="is-selected",h="."+r,c="aria-selected",d="aria-multiselectable",u=":visible",g="data-id",p="data-rownum",m="class",f="true",_=Object.entries,b=t.applyTemplate,C=t=>parseInt(t,10);function S(e,i){const s=i.cssClassPrefix||a;return t.escapeHTMLAttr(s+"-"+e)}function $(t,e){return"."+S(t,e)}const I="a-TMV",T=I+"--variableHeight",v="a-TMV-w-scroll",R="."+v,y="a-TMV-hdr",A="."+y,L="is-disabled",w="set",N="unset",E="toggle",P="range",O="add",k="selectionChange",D=".u-selector",F="is-focused",M="tabindex",x="u-RTL",K=n.ui.keyCode,H=/^\s*<[\w]+[^>]*>/,X=/<([^ <>]*)/,V="none",W="selection",G="focus";function U(t){t.APEX$ROW_STATE_CLASSES=t.APEX$AGG=t.APEX$AGG_TOTAL=t.APEX$ROW_URL=t.APEX$ROW_ID=t.APEX$ROW_INDEX=t.APEX$VALIDATION_MESSAGE=null}function j(t){return[V,G,W].includes(t)||(i.warn("Invalid value for itemNavigation ignored"),t="none"),t}n.widget("apex.tableModelView",n.apex.tableModelViewBase,{widgetEventPrefix:"tableModelView",options:{headerTemplate:"",beforeTemplate:"<ul>",bodyTemplate:"",getDataObjectCallback:"",preRendered:!1,recordTemplate:"",controlBreakTemplate:"",aggregateTemplate:"",afterTemplate:"</ul>",syncHeaderHScroll:!1,collectionClasses:null,iconClassColumn:null,imageURLColumn:null,imageAttributes:null,labelColumn:null,linkTarget:!1,linkTargetColumn:null,linkAttributes:null,tabbableContent:null,useIconList:!1,iconListOptions:{},itemNavigation:V,itemSelector:null,multiple:!1,constrainNavigation:!0,sortable:!1,selectionChange:null,pageChange:null,rowOrderChanged:null},_create:function(){const e=this.options,s=this.element;i.info(`TableModelView '${s[0].id}' created. Model: ${e.modelName}`),e.preRendered&&(this._preRendered=!0),s.addClass(I),e.fixedRowHeight||s.addClass(T),e.itemNavigation=j(e.itemNavigation),e.itemNavigation===W&&e.multiple&&s.attr(d,f),this.forwardKey=K.RIGHT,this.backwardKey=K.LEFT,"rtl"===s.css("direction")&&(s.addClass(x),this.forwardKey=K.LEFT,this.backwardKey=K.RIGHT),this._enforceOptionConstraints(),this._super(),this.recordHeight=null,this.recPerRow=null,this.lastFocused=null,this.hasSelection=!1,this._initModel(e.modelName),this._on(this._eventHandlers),this._initRecordTemplate(),this._selNotifyDelay=t.debounce(this._selChangeNotify,1),this._selNotifyLongDelay=t.debounce(this._selChangeNotify,350),this.refresh(),e.disabled&&this._setOption("disabled",e.disabled)},_eventHandlers:{keydown:function(t){const e=this.options,i=n(t.target),s=t.which;let o,a=!1,l=null;if(!t.isDefaultPrevented())if(e.useIconList){if(o=this.getIconList().options,!o.navigation&&o.noNavKeyContent&&n(t.target).closest(o.noNavKeyContent).length)return;if(s!==K.DOWN&&s!==this.getIconList().forwardKey||!e.pagination.loadMore)(s===K.UP||s===this.getIconList().backwardKey)&&e.pagination.loadMore&&n(t.target).hasClass("js-load")&&(this.getIconList().focus(),t.preventDefault());else{let e=this.element.find(".js-load");if(e[0]){if(e[0].disabled)return;e.trigger("focus"),t.preventDefault()}}!e.constrainNavigation||s!==K.DOWN&&s!==K.UP&&s!==K.LEFT&&s!==K.RIGHT&&s!==K.PAGE_UP&&s!==K.PAGE_DOWN||t.preventDefault()}else if(e.itemNavigation!==V){if(s===K.HOME)this._navToReportStart(t,!0),a=!0;else if(s===K.END)this._navToReportEnd(t,!0),a=!0;else if(s===K.DOWN||s===this.forwardKey){if(s===this.forwardKey&&t.altKey)return;l=this._getItem(n(this.lastFocused)).nextAll(u).first(),l&&l[0]||!e.pagination.loadMore||this.element.find(".js-load").trigger("focus")[0]&&(a=!0),s===K.DOWN&&e.constrainNavigation&&(a=!0)}else if(s===K.UP||s===this.backwardKey){if(s===this.forwardKey&&(t.altKey||t.metaKey))return;i.hasClass("js-load")?(this.focus(),a=!0):l=this._getItem(n(this.lastFocused)).prevAll(u).first(),s===K.UP&&t.stopPropagation()}else if(s===K.SPACE){if("BUTTON"===t.target.nodeName)return;l=this._getItem(n(this.lastFocused))}l&&l[0]&&(e.itemNavigation===W?this._select(l,t,!0,!0):n(this._getItemFocusable(l)).trigger("focus"),a=!0),a&&t.preventDefault()}},keyup:function(t){let e=this.options.sortable,i=t.which;!e||91!==i&&17!==i||this.element.trigger("sortUpdate")},mousedown:function(t){const e=this.options;if(e.itemNavigation===W&&(e.sortable||e.multiple)){let i=this._getItem(n(t.target));if(i&&i.length>0&&(t.preventDefault(),e.sortable)){let e={type:"click",shiftKey:t.shiftKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey};this._select(i,e,!0,!1,!1)}}},resize:function(t){t.target===this.element[0]&&(this.resize(),t.stopPropagation())},click:function(t){const e=this.options;if(e.itemNavigation===W){let i=n(t.target),s=this._getItem(i);s&&s.length>0&&(i.is(D)&&(t.ctrlKey=!0,t.shiftKey=!1),this._select(s,t,!0,!1,!1),e.tabbableContent&&i.closest(e.tabbableContent).length?i.trigger("focus"):t.preventDefault())}},sortUpdate:function(t){let e=n(t.target);this.options.rowOrderChanged&&this._trigger("rowOrderChanged"),e.trigger("focus")},focusin:function(t){if(this.options.itemNavigation!==V){let e=t.target,i=this._getItem(n(e));i&&i.length>0&&(i.addClass(F),this._setFocusable(e))}},focusout:function(t){if(this.options.itemNavigation!==V){let e=this._getItem(n(t.target));e&&e.length>0&&e.removeClass(F)}}},_destroy:function(){const t=this.element;this._tableModelViewDestroy(),t.removeClass(I+" "+L+" "+x).removeAttr(d).empty(),i.info(`TableModelView '${t[0].id}' destroyed. Model: ${this.options.modelName}`),this.data$=null,this._initModel(null)},_setOption:function(t,e){const s=this.element,o=this.options;if(i.info(`TabelModelView '${this.element[0].id}' set option '${t}' to: ${e}`),"iconListOptions"===t)throw new Error(`TabelModelView '${t}' cannot be set. Set options directly on the iconList widget`);if("itemNavigation"===t&&(e=j(e)),this._super(t,e),this._enforceOptionConstraints(),"disabled"===t){if(this.element.toggleClass(L,e),o.useIconList)return this.getIconList().option(t,e);this.lastFocused&&(e?this.lastFocused.tabIndex=-1:this._setFocusable(this.lastFocused)),e&&this.resize()}else"modelName"===t?(this._initModel(e),this.refresh(!1)):"highlights"===t?this._updateHighlights():"hideEmptyFooter"===t?this._updateTotalRecords():"multiple"===t||"itemNavigation"===t?(o.itemNavigation===W&&o.multiple?s.attr(d,f):s.removeAttr(d),this._initRecordTemplate(),this.refresh()):"fixedRowHeight"===t?(this.element.toggleClass(T,!e),this.refresh()):["beforeTemplate","recordTemplate","afterTemplate","collectionClasses","iconClassColumn","imageURLColumn","imageAttributes","itemSelector","labelColumn","linkTarget","linkTargetColumn","linkAttributes","bodyTemplate","entityTitleSingular","entityTitlePlural"].includes(t)?(this._initRecordTemplate(),this.refresh()):["footer","useIconList","pagination","rowsPerPage","sortable"].includes(t)&&this.refresh()},_enforceOptionConstraints:function(){const t=this.options;t.useIconList&&t.itemNavigation!==V&&(i.warn("Forced itemNavigation to none when useIconList is true"),t.itemNavigation=V),t.itemNavigation!==W&&t.persistSelection&&(i.warn("Forced persistSelection to false when itemNavigation is not selection"),t.persistSelection=!1)},refresh:function(t){const e=this.options,i=this,s=this.element;let o,a,l=!1;if(!0!==t&&(l=this._paginationHasFocus()),void 0===t&&(t=n(document.activeElement).closest(s).length>0),!this._refreshCheckIfVisible())return;let r=this.modelChanged;this.modelChanged=!1,this.data$&&!e.persistSelection?o=this.getSelectedRecords():e.persistSelection&&(a=this.hasSelection,this.hasSelection=!1),!e.hasSize&&this.data$&&s.css("min-height",s.height()+"px"),e._isTemplateReport?this._refreshPagination(s):this._refreshPagination(s.find(R)),this._initView(),e.sortable&&this.data$.sortable({placeholder:"sortable-placeholder",cursor:"move",cursorAt:{left:2},stop:function(){s.trigger("sortUpdate")}}),this._updateStatus(),this.resize(),this._preRendered&&!this.model._data.length||this._addPageOfRecords((function(){let h,c=!1;i.noData&&e.bodyTemplate&&i._initView(!0),l&&(i._restorePaginationFocus(l),t=!1),e.hasSize||s.css("min-height",""),e.itemNavigation===V||i.lastFocused||(i.lastFocused=i._getItemFocusable(i.data$.children(e.itemSelector)),i.lastFocused&&e.itemNavigation===W&&(i.selectAnchor=n(i.lastFocused).closest(e.itemSelector)[0]),i.lastFocused&&!e.disabled&&(h=i.lastFocused,i._setFocusable(i.lastFocused))),o&&o.length>0?(c=i.setSelectedRecords(o,!1,!0)>0,c&&!r||i._selNotifyDelay(!0,null)):e.persistSelection&&(a||r)&&i._selNotifyDelay(!0,null),h&&c&&i._setFocusable(h),t&&i.focus(),e.sortable&&i.data$.sortable("refresh")}),!0),this._preRendered&&delete this._preRendered},resize:function(){const t=this.element,e=this.options,i=t.height(),s=t.children().first(),o=t.find(R);let n,a;null!==t[0].offsetParent&&(s.length&&!this.pendingRefresh?(n=t.width(),e._isTemplateReport||o.width(n),this.recordHeight=null,this.recPerRow=null,e.hasSize&&(a=i-this._footerHeight(),s.height(a),o.height(a-(t.find(A).height()||0))),e.useIconList&&this.data$.iconList("resize"),this._initPageSize()):this.refresh())},focus:function(){const t=this.getIconList();if(t)return t.focus();this.options.itemNavigation!==V&&this.lastFocused?this.lastFocused.focus():this.data$.find(":focusable").first().trigger("focus")},getSelection:function(){const t=this.options,e=this.getIconList();return t.useIconList?e?e.getSelection():n():this.data$&&t.itemNavigation===W?this.data$.find(h):null},setSelection:function(t,e,i){const s=this.getIconList();s?s.setSelection(t,e,i):this.data$&&this.options.itemNavigation===W&&this._select(t,null,e,!1,i)},getRecords:function(t){let e=this.model,i=[];return t.each((function(){let t,s=n(this).attr(g);s&&(t=e.getRecord(s),t&&i.push(t))})),i},getSelectedRecords:function(){const t=this.options;return this.data$&&(t.useIconList||t.itemNavigation===W)?this.getRecords(this.getSelection()):null},setSelectedRecords:function(t,e,i){const s=this.options;let o=[],a=0,l=t.length,r=new Set;if(!this.data$||this.renderInProgress||s.itemNavigation!==W&&!s.useIconList)return-1;!s.multiple&&l>1&&(l=1);for(let e=0;e<l;e++)r.add(this.model.getRecordId(t[e]));if(this.data$.children().each((function(){let t=n(this).attr(g);r.has(t)&&(r.delete(t),o.push(this),a+=1)})),this.setSelection(n(o),e,i),s.persistSelection){for(let t of r){this.model.getRecord(t)&&(this.model.setSelectionState(t,!0),a+=1)}0!==o.length||i||this._selNotifyDelay(!0,null)}return a},getIconList:function(){return this.options.useIconList&&this.data$?this.data$.data("apex-iconList"):null},_getItem:function(t){let e=this.options.itemSelector;return e?t.closest(e):null},_initRecordTemplate:function(){const t=this.options;if(!t.recordTemplate){let e,i,s;if(t.collectionClasses||(t.collectionClasses="a-TMV-defaultIconView"),t.itemSelector||(t.itemSelector=".a-TMV-item"),!t.labelColumn)throw new Error("Option recordTemplate or labelColumn is required");t.beforeTemplate="<ul>",t.afterTemplate="</ul>",e=`<li ${g}='&APEX$ROW_ID.' ${p}='&APEX$ROW_INDEX.' class='a-TMV-item &APEX$ROW_STATE_CLASSES.'>`,t.linkTarget||t.linkTargetColumn?(s=t.linkTargetColumn?t.linkTargetColumn:"APEX$ROW_URL",e+=`<a href='&${s}.' class='a-IconList-content' ${t.linkAttributes?t.linkAttributes:""}>`,i="</a>"):(e+="<span class='a-IconList-content'>",i="</span>"),(t.iconClassColumn||t.imageURLColumn)&&(e+="<span class='a-IconList-icon'>",t.iconClassColumn?e+=`<span class='&${t.iconClassColumn}.'></span>`:e+=`<img src='&${t.imageURLColumn}.' ${t.imageAttributes?t.imageAttributes:""}/>`,e+="</span>"),e+=`<span class='a-IconList-label'>&${t.labelColumn}.</span>${i}</li>`,t.recordTemplate=e}t.itemNavigation===V||t.itemSelector||(i.warn("Forced itemNavigation to none because itemSelector not defined"),t.itemNavigation=V);let e=this.atOptions;e.model=this.model,e.record=null,U(e.extraSubstitutions),H.exec(b(t.recordTemplate,e))||t.bodyTemplate||(b(t.beforeTemplate,e).toLowerCase().match(/<ul|<ol/)?t.recordTemplate=`<li>${t.recordTemplate}</li>`:t.recordTemplate=`<div>${t.recordTemplate}</div>`)},_initView:function(e=!1){const i=this,s=this.element,o=this.options,n="scroll.tmvss",a=this._getDataRenderContext(),l=this.atOptions,r=l.extraSubstitutions;let h,c,d,u,g=0,p=0,f=null;function C(){g!==p&&(d[0].scrollLeft=g=p,u[0].scrollLeft=g,c.css("left",g)),f=null}l.model=this.model,l.record=null,U(r),this.recordElement="div",h=X.exec(b(o.recordTemplate,l)),h&&h.length>1&&(this.recordElement=h[1].toLowerCase()),o._isTemplateReport||a.markup("<div").attr(m,"a-TMV-body").markup(">"),o.bodyTemplate||this._renderAltDataMessages(a);let S=[];for(const[,t]of _(this.model.getOption("fields")))S.push(t);if(S.sort(((t,e)=>t.seq-e.seq)),r.APEX$COLUMNS=S,o.headerTemplate&&!this._preRendered&&a.markup(`<div class='${y}'>${b(o.headerTemplate,l)}</div>`),o.firstDisplayedRow>0&&(this.pageOffset=o.firstDisplayedRow,delete o.firstDisplayedRow,this.pageOffset>0&&o.lazyLoading&&(this.model._data.length=1)),this._preRendered){s.find($("footer",o)).remove(),this._renderLoadMore(a),this._renderFooter(a),s.append(a.toString())}else{o._isTemplateReport||a.markup("<div").attr(m,v).markup(" tabindex='-1'>");let t="";o.getDataObjectCallback?this.data$=o.getDataObjectCallback(s):t+=`<${this.recordElement} class='js-data-placeholder' style='display:none;'></${this.recordElement}>`,o._isTemplateReport&&this.data$&&this.data$.length&&(t+=this.data$.html()),o.bodyTemplate?(l.placeholders={},l.placeholders.APEX$HAS_MESSAGE=e?"T":"",l.placeholders.APEX$MESSAGE=o.noDataMessage,l.placeholders.APEX$MESSAGE_ICON=o.noDataIcon,l.placeholders.APEX$COMPONENT_CSS_CLASSES=o.componentCssClasses||"",l.placeholders.APEX$ROWS=t,a.markup(b(o.bodyTemplate,l))):(a.markup(b(o.beforeTemplate,l)).markup(t).markup(b(o.afterTemplate,l)),this._renderLoadMore(a)),o._isTemplateReport||a.markup("</div></div>"),e||(this.footer$&&this.footer$.prop("outerHTML")?a.markup(this.footer$.prop("outerHTML")):this._renderFooter(a)),s.html(a.toString())}if(o.getDataObjectCallback)this.data$=o.getDataObjectCallback(s);else{const t=s.find(".js-data-placeholder");this.data$=t.parent(),t.remove()}this.data$.addClass(o.collectionClasses||""),this._clearItemCache(),o.useIconList&&(this.data$.iconList(o.iconListOptions),this.data$.on("iconlistselectionchange",(function(t){i._updateStatus(),i._trigger(k,t)}))),u=o._isTemplateReport?s:s.find(R),d=s.find(A),this._initPagination(d,u),o.headerTemplate&&o.syncHeaderHScroll&&(c=this.data$.find($("loadMoreButton",o)),u.on(n,(function(){p=this.scrollLeft,f||(f=t.invokeAfterPaint(C))})),d.on(n,(function(){p=this.scrollLeft,f||(f=t.invokeAfterPaint(C))})))},_setFocusable:function(t){const e=this.options.tabbableContent;let i,s;this.lastFocused&&this.lastFocused!==t&&(e?(s=this._getItem(n(this.lastFocused)),s.add(s.find(e).not(":disabled")).prop("tabIndex",-1)):this.lastFocused.tabIndex=-1),e?(s=this._getItem(n(t)),i=s.find(e).not("disabled").prop("tabIndex",0).length,i||s.prop("tabIndex",0)):t.tabIndex=0,this.lastFocused=t},_getItemFocusable:function(t){const e=this.options.tabbableContent;if(e){let i=t.find(e);if(i.length)return i[0]}return t[0]},_initRecordMetrics:function(){let t,e,i=0,s=this.options;if(U(this.atOptions.extraSubstitutions),this.atOptions.record=null,this.recPerRow=1,t=this.data$.children().filter(u).first(),!t.length){let i,o="";for(i=0;i<20;i++)o+=b(s.recordTemplate,this.atOptions);e=n(o),t=this.data$.append(e).children().filter(u).first(),s.useIconList&&this.getIconList().refresh()}if(s.useIconList)this.recPerRow=this.getIconList().getColumns();else{let e=t,s=e.length>0?Math.trunc(e.offset().top):0,o=s,n=0;for(;o===s&&e[0];)n+=1,e=e.next(),e[0]&&(o=Math.trunc(e.offset().top));this.recPerRow=n,i=o-s}this.recPerRow<1&&(this.recPerRow=1),0===i&&(i=t.outerHeight(!0),"grid"===this.data$.css("display")&&(i+=C(this.data$.css("grid-row-gap")))),this.recordHeight=i||43,e&&e.remove()},_clearItemCache:function(){this.itemsCache$=null},_itemIndex:function(t){let e;return this.itemsCache$||(this.itemsCache$=this.data$.children()),e=this.itemsCache$,e.index(t)},_navToReportStart(t,e){const i=this.options,s=i.itemNavigation===W;t.ctrlKey=!1,i.pagination.scroll&&this.firstPage();let o=this.data$.children(i.itemSelector).filter(u).first();o[0]&&(s?this._select(o,t,!0,e):n(this._getItemFocusable(o)).trigger("focus"))},_navToReportEnd:function(t,e){const i=this.options,s=i.itemNavigation===W,o=()=>{s?this._select(a,{type:"keydown",shiftKey:t.shiftKey},!0,e):n(this._getItemFocusable(a)).trigger("focus")};t.ctrlKey=!1,i.pagination.scroll&&this.lastPage();let a=this.data$.children(u).last();a.hasClass(S(l,i))?(a=null,this.element.one("tablemodelviewpagechange",(()=>{a=this.data$.children(i.itemSelector).filter(u).last(),o()}))):(a=a.filter(i.itemSelector).last(),o())},_select:function(e,i,s,o,a){const d=this.options;let m,f,_,b,S,I,T,v=!1,R=null,y=w;const A=(t,e)=>{const i=t=>{t.each(((t,i)=>{let s=n(i).attr(g);s&&this.model.setSelectionState(s,e,y)}))};d.persistSelection&&!v&&(i(t),y!==E&&t.length>1&&i(_.first()))};if(i!==N&&(e=e.filter(u)),i&&d.multiple&&("string"==typeof i?y=i:"click"===i.type?i.ctrlKey||i.metaKey?y=E:i.shiftKey&&(y=P):"keydown"===i.type&&(i.which===K.SPACE?y=i.ctrlKey?E:i.shiftKey?P:O:i.ctrlKey?y="none":i.shiftKey&&(y=P)),i.target||(i=null)),d.persistSelection&&(I=this.model.getSelectionState().rangeAnchor),"all"===y?(v=!0,y=w):y!==P||this.selectAnchor||I||(y=w),y!==w&&y!==P||(T=this.data$.find(h),T.removeClass(r).removeAttr(c).find(D).removeClass(r),d.persistSelection&&this.model.clearSelection()),d.persistSelection&&v&&this.model.setSelectionState(null,!0,"all"),m=e.hasClass(r),_=e,y===w||y===O||y===E&&!m)_.addClass(r).attr(c,!0),A(_,!0),this.selectAnchor=_[0],R=!0;else if(y===P){let t,i,s,o,a=n(this.selectAnchor),h=e.last();if(t=this._itemIndex(a),d.persistSelection){let e=this.model.getRecordMetadata(I);e&&e.serverOffset&&(o=e.serverOffset+1,o!==C(a.attr(p))&&(t=-1))}if(i=this._itemIndex(h),t<0){let e=o||C(a.attr(p)),i=C(h.attr(p));if(d.pagination.virtual){let s=this.data$.find($(l,d)).toArray();if(i>e)for(let t=0;t<s.length&&(a=n(s[t]).next(),!(C(a.attr(p))>e));t++);else for(let t=s.length-1;t>=0&&(a=n(s[t]).prev(),!(C(a.attr(p))<e));t--);t=this._itemIndex(a)}else!d.pagination.scroll&&d.persistSelection&&(a=this.itemsCache$[i>e?"first":"last"](),t=this._itemIndex(a))}d.persistSelection&&A(h,!0),t>i&&(s=i,i=t,t=s),i+=1,b=[],this.itemsCache$.slice(t,i).each((function(t,e){n(e).is(u)&&b.push(e)})),_=n(b),_.addClass(r).attr(c,!0),R=!0}else(y===E&&m||y===N)&&(_.removeClass(r).removeAttr(c),A(_,!1),this.selectAnchor=_[0],R=!1);null!==R&&_.find(D).toggleClass(r,R),d.multiple&&d.selectAll&&this._updateSelectAll(),e.length>0&&null!==s&&(f=this._getItemFocusable(e.first()),s?n(f).trigger("focus"):this._setFocusable(f)),d.persistSelection&&(this.hasSelection=this.model.getSelectedCount()>0),(y===E||y===N||y===P&&!m||y===O||y===w&&!t.arrayEqual(T,_))&&(S=!(a||d.navigation&&i&&"click"===i.type),o?this._selNotifyLongDelay(S,i):this._selNotifyDelay(S,i))},_selChangeNotify:function(t,e){this.element.hasClass(I)&&(this._updateStatus(),t&&this._trigger(k,e))},_getHeaderHeight:function(){return this.element.find(A).outerHeight()},_getFixedRecordHeight:function(){return this.recordHeight||this._initRecordMetrics(),this.recordHeight},_getRecordsPerRow:function(){return this.recPerRow||this._initRecordMetrics(),this.recPerRow},_getDataContainer:function(){return this.data$},_selectedCount:function(){let t=this.options;return t.useIconList?this.getIconList().getSelection().length:t.itemNavigation===W?this.getSelectedRecords().length:0},_hasControlBreaks:function(){return null!=this.options.controlBreakTemplate},_elementsFromRecordIds:function(e){let i=[];for(let s=0;s<e.length;s++){let o=this.data$[0].querySelector(`[${g}="${t.escapeCSS(e[s])}"]`);o&&i.push(n(o))}return i},_renderFillerRecord:function(t,e){t.markup(`<${this.recordElement} class='${e}'></${this.recordElement}>`)},_insertFiller:function(t,e){let i=n(t.toString());return e?e.before(i):this.data$.html(i),this._clearItemCache(),i},_initItems:function(t){const e=this.options;e.itemNavigation!==V&&t.attr(M,-1).find(e.tabbableContent).attr(M,-1)},_insertData:function(t,e,i,s,o){const a=this.options;let l=n(t.toString());if(s?s[o](l):this.data$.append(l),this._clearItemCache(),this._initItems(l),a.useIconList){let t=this.element.find(R),e=t.scrollTop();this.getIconList().refresh(),t.scrollTop(e)}this.atOptions.clearItemCache=!0,this._super(t,e,i,s,o)},_controlBreakLabel:function(t){return{record:t}},_renderBreakRecord:function(t,e,i,s){var o,n=this.options,a=this.atOptions,l=a.extraSubstitutions;U(l),a.model=this.model,a.record=i.record,l.APEX$ROW_INDEX=null!=s?""+(s+1):"",o=b(this.options.controlBreakTemplate,a),n.highlighter&&(o=n.highlighter(n.highlighterContext,o)),t.markup(o),this.atOptions.clearItemCache=!1},_renderRecord:function(t,e,i,s,o){const n=this.options;let a,l,h=n.recordTemplate,c="",d=this.atOptions,u=d.extraSubstitutions;if(U(u),o.agg){if(!n.aggregateTemplate)return;h=n.aggregateTemplate,u.APEX$AGG=o.agg,u.APEX$AGG_TOTAL=o.grandTotal?"Y":""}else o.url&&(u.APEX$ROW_URL=o.url),o.hidden&&(c+=" u-hidden"),o.sel&&(c+=" "+r),o.deleted?c+=" is-deleted":(o.inserted?c+=" is-inserted":o.updated&&(c+=" is-updated"),o.error?c+=" is-error":o.warning&&(c+=" is-warning"),o.highlight&&(a=n.highlights[o.highlight],a&&a.cssClass?c+=" "+a.cssClass:c+=" "+o.highlight),o.message&&(u.APEX$VALIDATION_MESSAGE=o.message)),c&&(u.APEX$ROW_STATE_CLASSES=c);u.APEX$ROW_ID=""+s,u.APEX$ROW_INDEX=""+(i+1),d.model=this.model,d.record=e,l=b(h,d),n.highlighter&&!o.agg&&(l=n.highlighter(n.highlighterContext,l)),t.markup(l),this.atOptions.clearItemCache=!1},_removeRecord:function(t){t.remove(),this._clearItemCache()},_insertRecord:function(e,i,s,o,a){const l=t.htmlBuilder();this._renderRecord(l,i,null,s,o),this.atOptions.clearItemCache=!0;let r=n(l.toString());return"after"===a&&e?e.after(r):this.data$.prepend(r),this._clearItemCache(),this._initItems(r),this.options.useIconList&&this.getIconList().refresh(),r},_afterInsert:function(){},_identityChanged:function(t,e){var i,s,o=this._elementsFromRecordIds([t])[0];o&&(i=this.model.getRecord(e),s=this.model.getRecordMetadata(e),this._replaceRecord(o,i,t,e,s))},_replaceRecord:function(e,i,s,o,a){const l=t.htmlBuilder();let r,h=e.attr(p)||null;null!==h&&(h=C(h)-1),this._renderRecord(l,i,h,o,a),this.atOptions.clearItemCache=!0,r=n(l.toString()),e.replaceWith(l.toString()),this._clearItemCache(),this._initItems(r),this.options.useIconList&&(this.getIconList().refresh(),this.getIconList().setSelection(n("[data-id="+a.record.id+"]")),this.focus())},_removeFocus:function(){},_checkAllHidden:t.debounce((function(){const t=this.options.pagination;this.data$.children().is(":visible")?!t.scroll||t.loadMore||t.virtual||this.data$.height()<this.scrollParent$.height()&&this._addNextPage():(this.noData$.show(),this.data$.hide(),this.noData=!0)}),10),_updateRecordState:function(t,e,i,s,o){if("hidden"===o)return this.noData&&!s.hidden&&(this.noData$.hide(),this.data$.show(),this.noData=!1),t.toggleClass("u-hidden",s.hidden),void(this.noData||this._checkAllHidden());this._replaceRecord(t,i,e,e,s)}})}(apex.util,apex.model,apex.debug,apex.lang,apex.item,apex.jQuery);